"use strict";(self.webpackChunkScheduler=self.webpackChunkScheduler||[]).push([[216],{8216:(de,T,l)=>{l.r(T),l.d(T,{ScheduleRoutingModule:()=>ue});var h=l(9794),a=l(8849),Z=l(1501),m=l(7627),e=l(9039),v=l(5397),f=l(6575);function w(n,r){if(1&n&&(e.TgZ(0,"div",8)(1,"label"),e._uU(2),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.hij("Duties of ",t.account.firstName,"")}}function I(n,r){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA()()),2&n){const t=r.$implicit;e.xp6(2),e.hij("",t.userFunction," ")}}function L(n,r){1&n&&(e.TgZ(0,"tr")(1,"td",10),e._UZ(2,"span",11),e.qZA()())}function N(n,r){if(1&n&&(e.TgZ(0,"tbody"),e.YNc(1,I,3,1,"tr",9)(2,L,3,0,"tr",5),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.userFunctions),e.xp6(1),e.Q6J("ngIf",!t.userFunctions)}}let Y=(()=>{class n{constructor(t,o,i,s,c){this.accountService=t,this.alertService=o,this.formBuilder=i,this.route=s,this.router=c,this.userFunctionIndexer=0,this.userFunctions=null,this.functions=[],this.submitted=!1,this.isLoggedAsAdmin=!1,this.isLoaded=!1,this.id=this.accountService.accountValue.id,this.isLoggedAsAdmin=this.accountService.isAdmin()}ngOnInit(){this.form=this.formBuilder.group({function:["",[a.kI.required,this.functionValidator]]}),this.accountService.getById(this.id).pipe((0,m.P)()).subscribe({next:t=>{this.account=t,this.isLoaded=!0,this.accountService.getTasks().pipe((0,m.P)()).subscribe({next:o=>{this.functions=o,this.userFunctions=t.userFunctions.slice(),console.log(this.account+this.id),this.form.get("function").setValue(this.functions[0]),this.userFunctionIndexer=t.userFunctions.length>0?parseInt(t.userFunctions[t.userFunctions.length-1].id):0},error:o=>{this.alertService.error(o)}})},error:t=>{this.alertService.error(t)}})}get f(){return this.form.controls}functionValidator(t){return""===t.value?{invalidFunction:!0}:null}get isAdmin(){return this.account.role==Z.uU.Admin}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(v.B),e.Y36(v.c),e.Y36(a.qu),e.Y36(h.gz),e.Y36(h.F0))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],decls:12,vars:3,consts:[["class","mb-3 col",4,"ngIf"],[1,"card-body",3,"formGroup"],[1,"border","border-primary","mb-2"],[1,"table","table-striped"],[2,"width","20%"],[4,"ngIf"],[1,"mb-3"],["routerLink","/schedule",1,"btn","btn-primary"],[1,"mb-3","col"],[4,"ngFor","ngForOf"],["colspan","4",1,"text-center"],[1,"spinner-border","spinner-border-lg","align-center"]],template:function(o,i){1&o&&(e.YNc(0,w,3,1,"div",0),e.TgZ(1,"form",1)(2,"div",2)(3,"table",3)(4,"thead")(5,"tr")(6,"th",4),e._uU(7,"Duty"),e.qZA()()(),e.YNc(8,N,3,2,"tbody",5),e.qZA()(),e.TgZ(9,"div",6)(10,"a",7),e._uU(11,"Back"),e.qZA()()()),2&o&&(e.Q6J("ngIf",i.isLoaded),e.xp6(1),e.Q6J("formGroup",i.form),e.xp6(7),e.Q6J("ngIf",i.functions))},dependencies:[f.sg,f.O5,h.rH,a._Y,a.JL,a.sg],encapsulation:2})}return n})(),E=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["schedule-layout-component"]],decls:3,vars:0,consts:[[1,"p-4"],[1,"container"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"router-outlet"),e.qZA()())},dependencies:[h.lC],encapsulation:2})}return n})();function P(n,r){if(1&n&&(e.TgZ(0,"label"),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij("Choose Property for ",t.account.firstName,"")}}function J(n,r){if(1&n&&(e.TgZ(0,"td",6)(1,"a",7),e._uU(2,"Duties"),e.qZA(),e._uU(3," \xa0 "),e.TgZ(4,"a",7),e._uU(5,"Schedules"),e.qZA()()),2&n){const t=e.oxw();e.xp6(1),e.MGl("routerLink","function/",t.account.id,""),e.xp6(3),e.MGl("routerLink","schedules/",t.account.id,"")}}let q=(()=>{class n{constructor(t){this.accountService=t,this.account=this.accountService.accountValue}ngOnInit(){this.account?console.log(this.account.firstName):console.log("account is NULL")}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(v.B))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],decls:11,vars:2,consts:[[1,"mb-3","col"],[4,"ngIf"],[1,"table","table-striped"],["style","white-space: nowrap",4,"ngIf"],[1,"mb-3"],["routerLink","/profile",1,"btn","btn-link"],[2,"white-space","nowrap"],[1,"btn","btn-sm","btn-primary","mr-2",3,"routerLink"]],template:function(o,i){1&o&&(e.TgZ(0,"h1"),e._uU(1,"User Properties"),e.qZA(),e.TgZ(2,"div",0),e.YNc(3,P,2,1,"label",1),e.qZA(),e.TgZ(4,"table",2)(5,"tbody")(6,"tr"),e.YNc(7,J,6,2,"td",3),e.qZA()(),e.TgZ(8,"div",4)(9,"a",5),e._uU(10,"Back"),e.qZA()()()),2&o&&(e.xp6(3),e.Q6J("ngIf",i.account),e.xp6(4),e.Q6J("ngIf",i.account))},dependencies:[f.O5,h.rH],encapsulation:2})}return n})();var A=l(9616),u=l(3187),Q=l(7028),k=l(5474),g=l(8540),F=l(553),x=l(8200),B=l(2965);const G=["paginator"];function M(n,r){if(1&n&&(e.TgZ(0,"div",26)(1,"label"),e._uU(2),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.hij("Schedules for ",t.account.firstName,"")}}function O(n,r){if(1&n&&(e.TgZ(0,"span",31),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.lnq(" ",t.date,"/",t.userFunction,"/",t.scheduleGroup," ")}}function R(n,r){if(1&n&&(e.TgZ(0,"span",31),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.AsE(" ",t.date,"/",t.userFunction," ")}}function V(n,r){if(1&n&&(e.TgZ(0,"option"),e.YNc(1,O,2,3,"span",4)(2,R,2,2,"span",4),e.qZA()),2&n){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf","Cleaner"===t.userFunction),e.xp6(1),e.Q6J("ngIf","Cleaner"!=t.userFunction)}}function H(n,r){if(1&n&&(e.TgZ(0,"div")(1,"div",27)(2,"label"),e._uU(3,"Date/Time"),e.qZA(),e.TgZ(4,"select",28,29),e.YNc(6,V,3,2,"option",30),e.qZA()()()),2&n){const t=e.oxw();e.xp6(6),e.Q6J("ngForOf",t.poolElements)}}function $(n,r){1&n&&e._UZ(0,"span",31)}function j(n,r){1&n&&(e.TgZ(0,"div",32),e._UZ(1,"span",33),e.qZA())}function z(n,r){1&n&&(e.TgZ(0,"mat-header-cell",34),e._uU(1," Date/Time "),e.qZA())}function K(n,r){if(1&n&&(e.TgZ(0,"mat-cell"),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.xp6(1),e.hij("",t.date," ")}}function X(n,r){1&n&&(e.TgZ(0,"mat-header-cell",34),e._uU(1," Duty "),e.qZA())}function W(n,r){if(1&n&&(e.TgZ(0,"mat-cell"),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.xp6(1),e.hij("",t.userFunction," ")}}function ee(n,r){1&n&&(e.TgZ(0,"mat-header-cell",34),e._uU(1," Team "),e.qZA())}function te(n,r){if(1&n&&(e.TgZ(0,"mat-cell"),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.xp6(1),e.hij("",t.scheduleGroup," ")}}function ne(n,r){1&n&&(e.TgZ(0,"mat-header-cell"),e._uU(1," Action "),e.qZA())}function oe(n,r){1&n&&e._UZ(0,"span",31)}const y=n=>({disabled:n});function ie(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-cell")(1,"button",35),e.NdJ("click",function(i){const s=e.CHM(t),c=s.$implicit,p=s.index,_=s.$implicit,d=e.oxw();return e.KtG(d.onDeleteSchedule(i,c,p,_))}),e.YNc(2,oe,1,0,"span",4),e._uU(3," Delete "),e.qZA()()}if(2&n){const t=r.$implicit,o=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(2,y,o.isScheduleFromPast(t)||t.deleting)),e.xp6(1),e.Q6J("ngIf",t.deleting)}}function se(n,r){1&n&&e._UZ(0,"mat-header-row")}const re=n=>({hovered:n});function ce(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-row",36,37),e.NdJ("mouseover",function(){const s=e.CHM(t).$implicit;return e.KtG(s.hovered=!0)})("mouseout",function(){const s=e.CHM(t).$implicit;return e.KtG(s.hovered=!1)})("click",function(){const s=e.CHM(t).$implicit,c=e.MAs(1),p=e.oxw();return e.KtG(p.onRowSelected(s,c))}),e.qZA()}2&n&&e.Q6J("ngClass",e.VKq(1,re,r.$implicit.hovered))}const le=()=>[5,10,30,50],U=[{key:"date",type:"Date",label:"DateTime"},{key:"userFunction",type:"text",label:"Duty"},{key:"scheduleGroup",type:"text",label:"Group"},{key:"action",type:"button",label:"Action"}],D=864e5,ae=[{path:"",component:E,children:[{path:"",component:q},{path:"function/:id",component:Y},{path:"schedules/:id",component:(()=>{class n{constructor(t,o,i,s,c,p){this.route=o,this.router=i,this.formBuilder=s,this.alertService=c,this.cdr=p,this.CLEANER_STR=x.g.CLEANER_STR,this.schedules=[],this.userFunctionIndexer=0,this.functions=[],this.submitted=!1,this.isLoaded=!1,this.addingSchedule=!1,this.userFunctions=[],this.isAdding=!1,this.isLoggedAsAdmin=!1,this.date=(new Date).toISOString().slice(0,16),this.poolElements=[],this.isAddScheduleMode=!1,this.displayedColumns=U.map(d=>d.key),this.columnsSchema=U,this.color="primary",this.accountService=t,this.id=this.accountService.accountValue.id,this.isLoggedAsAdmin=this.accountService.isAdmin(),this.connection=(new Q.s).configureLogging(k.i.Information).withUrl(F.N.baseUrl+"/update").build(),this.connection.start().then(function(){console.log("SignalR Connected!")}).catch(function(d){return console.error(d.toString())}),this.connection.on("SendUpdate",d=>{d!=parseInt(this.id)&&console.log("Error"),this.updateSchedulesAndPoolFromServer()})}ngAfterViewInit(){this.accountService.getById(this.id).pipe((0,m.P)()).subscribe({next:t=>{this.accountService.getTasks().pipe((0,m.P)()).subscribe({next:o=>{this.functions=o,this.initSchedules(t),this.sort.sort({id:"date",start:"asc"}),this.isLoaded=!0,this.userFunctions=t.userFunctions.slice(),this.account=t,this.userFunctionIndexer=t.userFunctions.length>0?parseInt(t.userFunctions[t.userFunctions.length-1].id):0,this.accountService.getAvailableSchedules(t.id).pipe((0,m.P)()).subscribe({next:s=>{this.poolElements=s.schedulePoolElements,this.fixUpPoolDateStrings(),0!=this.poolElements.length&&this.form.get("availableSchedule4Function").setValue(this.getConcatPoolElement(this.poolElements[0]))},error:s=>{this.alertService.error(s)}})},error:o=>{this.alertService.error(o)}})},error:t=>{this.alertService.error(t)}})}ngOnInit(){this.isAddScheduleMode=this.isLoggedAsAdmin,this.form=this.formBuilder.group({availableSchedule4Function:[""],allDates:[!1,""]})}getConcatPoolElement(t){return this.poolElements[0].userFunction==this.CLEANER_STR?t.date+"/"+t.userFunction+"/"+t.scheduleGroup:t.date+"/"+t.userFunction}ngOnDestroy(){console.log("Called"),this.connection.stop()}applyFilter(t,o){var s=t.value;s=(s=s.trim()).toLowerCase(),this.dataSource.filter=s}onCheckboxChange(t){this.updateSchedulesAndPoolFromServer()}functionValidator(t){return""===t.value?{invalidFunction:!0}:null}get f(){return this.form.controls}onAddAvailableSchedule(){if(this.submitted=!0,this.addingSchedule=!0,this.alertService.clear(),!this.form.invalid){var t=this.createScheduleFromAvailableDateString("availableSchedule4Function");null!=t&&(this.isAdding=!0,this.accountService.getScheduleFromPool(this.account.id,t).pipe((0,m.P)()).subscribe({next:o=>{this.addingSchedule=!1,console.log(o),this.initSchedules(o),0!=this.poolElements.length&&this.form.get("availableSchedule4Function").setValue(this.getConcatPoolElement(this.poolElements[0])),this.updateSchedulesAndPoolFromServer()},complete:()=>{this.isAdding=!1},error:o=>{this.addingSchedule=!1,this.alertService.error(o),this.isAdding=!1,this.updateSchedulesAndPoolFromServer()}}))}}onDeleteSchedule(t,o,i,s){s.deleting=!0,this.accountService.moveSchedule2Pool(this.account.id,s).pipe((0,m.P)()).subscribe({next:c=>{this.updateSchedulesAndPoolFromServer(),this.schedules=c.schedules,s.deleting=!1},error:c=>{this.alertService.error(c),this.updateSchedulesAndPoolFromServer(),s.deleting=!1}})}updateSchedulesAndPoolFromServer(){this.accountService.getById(this.id).pipe((0,m.P)()).subscribe({next:t=>{this.initSchedules(t),this.accountService.getAvailableSchedules(t.id).pipe((0,m.P)()).subscribe({next:o=>{console.log("Pool Elements:"+o),this.poolElements=o.schedulePoolElements,this.fixUpPoolDateStrings(),0!=this.poolElements.length&&this.form.get("availableSchedule4Function").setValue(this.getConcatPoolElement(this.poolElements[0]))},error:o=>{this.alertService.error(o)}})},error:t=>{this.alertService.error(t)}})}initSchedules(t){var o=[],s=(new Date).getTime();for(let S=0;S<t.schedules.length;S++){const b=t.schedules[S];b.date.toString();var d=g(g.utc(b.date)).local().toDate().getTime();(this.f.allDates.value||d-s>D)&&o.push(b)}this.schedules=o.slice(),this.fixUpScheduleDateStrings(),this.dataSource=new u.by(this.schedules),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}fixUpPoolDateStrings(){this.poolElements.forEach(t=>{var o=new Date(t.date),i=g(o).format(x.g.dateTimeFormat);t.date=i})}fixUpScheduleDateStrings(){this.schedules.forEach(t=>{var o=new Date(t.date),i=g(o).format(x.g.dateTimeFormat);t.date=i})}createScheduleFromAvailableDateString(t){const i=this.form.controls[t].value.split("/");var s=i[0],c=i[1],p=i[2],_=Date.parse(i[0]);for(let C=0;C<this.schedules.length;C++){var d=new Date(this.schedules[C].date).getTime(),S=this.schedules[C].userFunction;if(d==_&&S==c)return this.alertService.warn("You are already "+S+" for that date/time"),null}return{accountId:this.account.id,date:s,newDate:s,dob:this.account.dob,required:!0,deleting:!1,userAvailability:!0,scheduleGroup:p,userFunction:c,newUserFunction:c}}isScheduleFromPast(t){return g(g.utc(t.date)).local().toDate().getTime()-Date.now()<D}onRowSelected(t,o){}get isAdmin(){return this.account.role==Z.uU.Admin}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(v.B),e.Y36(h.gz),e.Y36(h.F0),e.Y36(a.qu),e.Y36(v.c),e.Y36(e.sBO))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["app-schedule"]],viewQuery:function(o,i){if(1&o&&(e.Gf(G,5),e.Gf(A.YE,5)),2&o){let s;e.iGM(s=e.CRH())&&(i.paginator=s.first),e.iGM(s=e.CRH())&&(i.sort=s.first)}},decls:43,vars:16,consts:[["class","mb-3 col",4,"ngIf"],[3,"formGroup"],[4,"ngIf"],["type","button",1,"btn","btn-primary",3,"ngClass","click"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],["type","checkbox","formControlName","allDates","id","allDates","name","allDates","value","",3,"change"],["for","allDates",1,"ps-2"],["class","d-flex justify-content-center",4,"ngIf"],[1,"color-sample","mat-elevation-z3","mb-2"],[1,"border"],["matSort","",3,"dataSource"],["table",""],["matColumnDef","date"],["mat-sort-header","",4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","userFunction"],["matColumnDef","scheduleGroup"],["matColumnDef","action"],[4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[3,"ngClass","mouseover","mouseout","click",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"length","pageSizeOptions"],["paginator",""],[1,"mb-3"],["routerLink","/schedule","disabled","false",1,"btn","btn-primary"],[1,"row","mt-3"],[1,"mb-3","col"],[1,"col"],["formControlName","availableSchedule4Function",1,"form-select"],["element",""],[4,"ngFor","ngForOf"],[1,"spinner-border","spinner-border-sm","mr-1"],[1,"d-flex","justify-content-center"],[1,"spinner-border","spinner-border-lg","align-center"],["mat-sort-header",""],["type","button",1,"btn","btn-sm","btn-danger","btn-delete-account",3,"ngClass","click"],[3,"ngClass","mouseover","mouseout","click"],["tr",""]],template:function(o,i){1&o&&(e.YNc(0,M,3,1,"div",0),e.TgZ(1,"form",1)(2,"fieldset")(3,"legend"),e._uU(4,"Available Dates:"),e.qZA(),e.YNc(5,H,7,1,"div",2),e._UZ(6,"br"),e.TgZ(7,"button",3),e.NdJ("click",function(){return i.onAddAvailableSchedule()}),e.YNc(8,$,1,0,"span",4),e._uU(9," Add "),e.qZA()(),e.TgZ(10,"fieldset")(11,"legend"),e._uU(12,"Assigned Dates:"),e.qZA(),e.TgZ(13,"input",5),e.NdJ("change",function(c){return i.onCheckboxChange(c)}),e.qZA(),e.TgZ(14,"label",6),e._uU(15,"All"),e.qZA(),e._UZ(16,"br"),e.qZA()(),e._UZ(17,"br"),e.YNc(18,j,2,0,"div",7),e.TgZ(19,"div",8)(20,"div",9)(21,"mat-table",10,11),e.ynx(23,12),e.YNc(24,z,2,0,"mat-header-cell",13)(25,K,2,1,"mat-cell",14),e.BQk(),e.ynx(26,15),e.YNc(27,X,2,0,"mat-header-cell",13)(28,W,2,1,"mat-cell",14),e.BQk(),e.ynx(29,16),e.YNc(30,ee,2,0,"mat-header-cell",13)(31,te,2,1,"mat-cell",14),e.BQk(),e.ynx(32,17),e.YNc(33,ne,2,0,"mat-header-cell",18)(34,ie,4,4,"mat-cell",14),e.BQk(),e.YNc(35,se,1,0,"mat-header-row",19)(36,ce,2,3,"mat-row",20),e.qZA(),e._UZ(37,"mat-paginator",21,22),e.qZA()(),e.TgZ(39,"div",23)(40,"a",24),e._uU(41,"Back"),e.qZA()(),e._UZ(42,"div",25)),2&o&&(e.Q6J("ngIf",i.isLoaded),e.xp6(1),e.Q6J("formGroup",i.form),e.xp6(4),e.Q6J("ngIf",!i.isLoggedAsAdmin),e.xp6(2),e.Q6J("ngClass",e.VKq(13,y,!i.form.controls.availableSchedule4Function.valid||i.poolElements.length<=0||i.isAdding)),e.xp6(1),e.Q6J("ngIf",i.isAdding),e.xp6(10),e.Q6J("ngIf",!i.account),e.xp6(1),e.Udp("background-color",i.color),e.xp6(2),e.Q6J("dataSource",i.dataSource),e.xp6(14),e.Q6J("matHeaderRowDef",i.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",i.displayedColumns),e.xp6(1),e.Q6J("length",i.schedules.length)("pageSizeOptions",e.DdM(15,le)))},dependencies:[f.mk,f.sg,f.O5,h.rH,a._Y,a.YN,a.Kr,a.Wl,a.EJ,a.JJ,a.JL,a.sg,a.u,u.BZ,u.fO,u.as,u.w1,u.Dz,u.nj,u.ge,u.ev,u.XQ,u.Gk,A.YE,A.nU,B.NW],styles:["fieldset[_ngcontent-%COMP%]{margin:8px;border:1px solid silver;padding:8px;border-radius:4px}legend[_ngcontent-%COMP%]{background-color:#000;color:#fff;padding:3px 6px}"]})}return n})()}]}];let ue=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#n=this.\u0275inj=e.cJS({imports:[h.Bz.forChild(ae),h.Bz]})}return n})()}}]);
//# sourceMappingURL=216.7b7c732231263c50.js.map