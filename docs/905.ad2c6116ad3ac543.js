"use strict";(self.webpackChunkScheduler=self.webpackChunkScheduler||[]).push([[905],{905:(Gt,q,d)=>{d.r(q),d.d(q,{AccountsModule:()=>Jt,AppDateAdapter:()=>qt});var m=d(6575),T=d(8691),w=d(5901),c=d(8849),U=d(1065),x=d(1863),M=d(2682),v=d(476),F=d(3049),y=d(2965),e=d(9039);let Y=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[x.BQ]}),r})();var k=d(6988),S=d(9616),u=d(3187),L=d(6915),p=d(8200),J=d(4970),R=d(2418);const H={parse:{dateInput:p.g.dateFormat},display:{dateInput:p.g.dateFormat,monthYearLabel:"MMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}};let V=(()=>{class r{static#e=this.\u0275fac=function(n){return new(n||r)};static#t=this.\u0275mod=e.oAB({type:r});static#n=this.\u0275inj=e.cJS({providers:[{provide:x._A,useClass:R.t7,deps:[x.Ad]},{provide:x.sG,useValue:H}],imports:[m.ez,c.u5,c.UX,J.q,S.JX,u.p0,y.TU,U.ot,M.FA,x.XK,F.c,v.lN,k.LD]})}return r})();var K=d(3585),g=d(9794),h=d(7627),N=d(1501),_=d(5397);function $(r,o){if(1&r&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&r){const t=o.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function X(r,o){1&r&&(e.TgZ(0,"div",18),e._uU(1,"Duty can't be empty"),e.qZA())}function z(r,o){1&r&&(e.TgZ(0,"div",18),e._uU(1,"Group can't be empty"),e.qZA())}function j(r,o){if(1&r&&(e.TgZ(0,"div",19)(1,"div",11)(2,"div",20)(3,"label",21),e._uU(4,"Team"),e.qZA(),e._UZ(5,"input",22,23),e.qZA()(),e.YNc(7,z,2,0,"div",15),e.qZA()),2&r){const t=e.oxw(3);e.xp6(7),e.Q6J("ngIf",t.submitted&&t.form.controls.cleanerGroup.hasError("invalidGroup"))}}const W=r=>({"is-invalid":r});function ee(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"div",11)(1,"div",12)(2,"label"),e._uU(3),e.qZA(),e.TgZ(4,"select",13),e.NdJ("change",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.onDutyChanged(i))}),e.YNc(5,$,2,2,"option",14),e.qZA(),e.YNc(6,X,2,0,"div",15),e.qZA(),e.YNc(7,j,8,1,"div",16),e.qZA()}if(2&r){const t=e.oxw(2);e.xp6(3),e.hij("Choose Duties for ",t.account.firstName,""),e.xp6(1),e.Q6J("ngClass",e.VKq(5,W,t.submitted&&t.f.function.errors)),e.xp6(1),e.Q6J("ngForOf",t.functions),e.xp6(1),e.Q6J("ngIf",t.submitted&&t.form.controls.function.hasError("invalidFunction")),e.xp6(1),e.Q6J("ngIf",t.isCleaner)}}function te(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"td",26)(1,"button",27),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,a=e.oxw(3);return e.KtG(a.deleteFunction(i))}),e._uU(2," Delete "),e.qZA()()}}function ne(r,o){if(1&r&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.YNc(5,te,3,0,"td",25),e.qZA()),2&r){const t=o.$implicit,n=e.oxw(3);e.xp6(2),e.hij("",t.userFunction," "),e.xp6(2),e.hij("",t.group," "),e.xp6(1),e.Q6J("ngIf",n.accountService.isAdmin())}}function re(r,o){if(1&r&&(e.TgZ(0,"tbody"),e.YNc(1,ne,6,3,"tr",24),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.userFunctions)}}function ie(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"form",1)(1,"div",2),e.YNc(2,ee,8,7,"div",3),e.TgZ(3,"div",4)(4,"table",5)(5,"thead")(6,"tr")(7,"th",6),e._uU(8,"Duty"),e.qZA(),e.TgZ(9,"th",6),e._uU(10,"Group"),e.qZA()()(),e.YNc(11,re,2,1,"tbody",7),e.TgZ(12,"div",8)(13,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.addFunction())}),e._uU(14," Add Duty "),e.qZA()()()()(),e.TgZ(15,"div",8)(16,"a",10),e._uU(17,"Back"),e.qZA()()()}if(2&r){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(2),e.Q6J("ngIf",t.isLoggedAsAdmin),e.xp6(9),e.Q6J("ngIf",t.functions)}}let oe=(()=>{class r{constructor(t,n,i,a,s){this.alertService=n,this.formBuilder=i,this.route=a,this.router=s,this.userFunctionIndexer=0,this.userFunctions=[],this.functions=[],this.submitted=!1,this.isLoggedAsAdmin=!1,this.loading=!1,this.isLoaded=!1,this.accountService=t,this.isLoggedAsAdmin=this.accountService.isAdmin()}ngOnInit(){this.id=this.route.snapshot.params.id,this.accountService.getById(this.id).pipe((0,h.P)()).subscribe({next:t=>{this.accountService.getTasks().pipe((0,h.P)()).subscribe({next:n=>{this.functions=n,this.account=t,this.userFunctions=t.userFunctions.slice(),console.log(this.account+this.id),this.form=this.formBuilder.group({function:["",[c.kI.required,this.functionValidator]],cleanerGroup:["",[this.groupValidator.bind(this)]]},{validator:i=>"Cleaner"==i.controls.function.value?c.kI.required(i.controls.cleanerGroup):null}),this.form.get("function").setValue(this.functions[0]),this.userFunctionIndexer=t.userFunctions.length>0?parseInt(t.userFunctions[t.userFunctions.length-1].id):0,this.isLoaded=!0},error:n=>{this.alertService.error(n)}})},error:t=>{this.alertService.error(t)}})}get f(){return this.form.controls}functionValidator(t){return""===t.value?{invalidFunction:!0}:null}groupValidator(t){return this.isCleaner&&""===t.value?{invalidGroup:!0}:null}get isValid(){return this.form.valid}addFunction(){this.submitted=!0;var t=this.form.controls.function.value;for(let i=0;i<this.userFunctions.length;i++)if(this.userFunctions[i].userFunction===t)return void this.alertService.error(t+" already exists");if(!this.form.invalid){var n={id:(++this.userFunctionIndexer).toString(),userFunction:this.form.controls.function.value,group:this.f.cleanerGroup.value};this.userFunctions.push(n),this.addFunction4Account(n)}}deleteFunction(t){this.deleteFunction4Account(t)}addFunction4Account(t){this.accountService.addFunction(this.id,t).pipe((0,h.P)()).subscribe({next:n=>{this.userFunctions=n.userFunctions.slice()},error:n=>{this.alertService.error(n),this.loading=!1}})}deleteFunction4Account(t){this.accountService.deleteFunction(this.id,t).pipe((0,h.P)()).subscribe({next:n=>{this.userFunctions=n.userFunctions.slice(),this.alertService.success("Update successful",{keepAfterRouteChange:!0})},error:n=>{this.alertService.error(n),this.loading=!1}})}get isAdmin(){return this.account.role==N.uU.Admin}get isCleaner(){return null!=this.form&&this.form.get("function").value===p.g.CLEANER_STR}get group(){var t=this.account.userFunctions.find(n=>(console.log(n),n.group.length>0));return null!=t?t.group:""}onDutyChanged(t){t.target.value==p.g.CLEANER_STR&&this.f.cleanerGroup.setValue(this.group)}static#e=this.\u0275fac=function(n){return new(n||r)(e.Y36(_.B),e.Y36(_.c),e.Y36(c.qu),e.Y36(g.gz),e.Y36(g.F0))};static#t=this.\u0275cmp=e.Xpm({type:r,selectors:[["ng-component"]],decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"border-primary"],["class","row",4,"ngIf"],[1,"border","border-primary"],[1,"table","table-striped"],[2,"width","20%"],[4,"ngIf"],[1,"mb-3"],["type","button",1,"btn","btn-primary",3,"click"],["routerLink","/admin/accounts",1,"btn","btn-link"],[1,"row"],[1,"mb-3","col-5"],["formControlName","function",1,"form-select",3,"ngClass","change"],[3,"value",4,"ngFor","ngForOf"],["class","alert alert-danger",4,"ngIf"],["class","col-3",4,"ngIf"],[3,"value"],[1,"alert","alert-danger"],[1,"col-3"],[1,"col-1","pb-3"],["for","group"],["type","text","formControlName","cleanerGroup","name","group","placeholder","Specify a group"],["data",""],[4,"ngFor","ngForOf"],["style","white-space: nowrap",4,"ngIf"],[2,"white-space","nowrap"],["type","button",1,"btn","btn-sm","btn-danger","btn-delete-account",3,"click"]],template:function(n,i){1&n&&e.YNc(0,ie,18,3,"form",0),2&n&&e.Q6J("ngIf",i.isLoaded&&!i.isAdmin)},dependencies:[m.mk,m.sg,m.O5,c._Y,c.YN,c.Kr,c.Fj,c.EJ,c.JJ,c.JL,c.sg,c.u,g.rH],styles:[".flex-container[_ngcontent-%COMP%]{width:80%;min-height:300px;margin:0 auto;display:flex}"]})}return r})();function ae(r,o){1&r&&e._UZ(0,"span",19)}function se(r,o){if(1&r&&(e.TgZ(0,"div",25)(1,"button",22),e._uU(2,"Duties"),e.qZA()()),2&r){const t=e.oxw().$implicit;e.xp6(1),e.MGl("routerLink","function/",t.id,""),e.Q6J("disabled",!t.isVerified)}}function ce(r,o){if(1&r&&(e.TgZ(0,"div",25)(1,"button",22),e._uU(2,"Schedule"),e.qZA()()),2&r){const t=e.oxw().$implicit;e.xp6(1),e.MGl("routerLink","schedule/",t.id,""),e.Q6J("disabled",!t.isVerified)}}function le(r,o){1&r&&e._UZ(0,"span",28)}function ue(r,o){1&r&&(e.TgZ(0,"span"),e._uU(1,"Delete"),e.qZA())}function de(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td",20)(10,"div",0)(11,"div",21)(12,"button",22),e._uU(13,"Edit"),e.qZA()(),e.YNc(14,se,3,2,"div",23)(15,ce,3,2,"div",24),e.TgZ(16,"div",25)(17,"button",26),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.deleteAccount(a.id))}),e.YNc(18,le,1,0,"span",27)(19,ue,2,0,"span",18),e.qZA()()()()()}if(2&r){const t=o.$implicit,n=e.oxw();e.xp6(2),e.lnq("",t.title," ",t.firstName," ",t.lastName,""),e.xp6(2),e.Oqu(t.email),e.xp6(2),e.Oqu(t.dob),e.xp6(2),e.Oqu(t.role),e.xp6(4),e.MGl("routerLink","add-edit/edit/",t.id,""),e.Q6J("disabled",!t.isVerified),e.xp6(2),e.Q6J("ngIf",t.role!=n.RoleAdminEnum),e.xp6(1),e.Q6J("ngIf",t.role!=n.RoleAdminEnum),e.xp6(2),e.Q6J("disabled",t.isDeleting),e.xp6(1),e.Q6J("ngIf",t.isDeleting),e.xp6(1),e.Q6J("ngIf",!t.isDeleting)}}function me(r,o){1&r&&(e.TgZ(0,"tr")(1,"td",29),e._UZ(2,"span",30),e.qZA()())}let pe=(()=>{class r{constructor(t,n){this.accountService=t,this.alertService=n,this.isDeleting=!1}ngOnInit(){this.refreshList()}refreshList(){this.accountService.getAll().pipe((0,h.P)()).subscribe(t=>{this.accounts=t,this.accounts.sort(function(n,i){return n.role.localeCompare(i.role)})}),this.accountService.getAutoEmail().pipe((0,h.P)()).subscribe(t=>{this.autoEmail=t})}deleteAccount(t){this.accounts.find(i=>i.id===t).isDeleting=!0,this.accountService.delete(t).pipe((0,h.P)()).subscribe(()=>{this.accounts=this.accounts.filter(i=>i.id!==t)})}get RoleAdminEnum(){return N.uU.Admin}onDeleteAllUserAccounts(t){this.isDeleting=!0,this.accountService.deleteAllUserAccounts().pipe((0,h.P)()).subscribe({next:n=>{this.refreshList(),console.log(n)},complete:()=>{this.isDeleting=!1},error:n=>{this.alertService.error(n),this.isDeleting=!1}})}onChangeHandler(t,n){this.accountService.setAutoEmail(new Boolean(t.target.checked)).pipe((0,h.P)()).subscribe({next:i=>{this.autoEmail=i},complete:()=>{},error:i=>{this.alertService.error(i)}})}static#e=this.\u0275fac=function(n){return new(n||r)(e.Y36(_.B),e.Y36(_.c))};static#t=this.\u0275cmp=e.Xpm({type:r,selectors:[["ng-component"]],decls:46,vars:5,consts:[[1,"container"],[1,"row","equal"],[1,"mb-3","col-2","gx-0"],["type","checkbox",3,"checked","disabled","click"],["tr",""],[1,"col-2"],["routerLink","add-edit/add",1,"btn","btn-sm","btn-success","mb-2"],["routerLink","upload",1,"btn","btn-sm","btn-success","mb-2"],["routerLink","schedule-generate",1,"btn","btn-sm","btn-success","mb-2"],["routerLink","auto-generate-schedules/generate",1,"btn","btn-sm","btn-success","mb-2"],["routerLink","./",1,"btn","btn-sm","btn-success","mb-2",3,"click"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],[1,"table","table-striped"],[2,"width","10%"],["src","./assets/images/email.png","alt",""],[2,"width","5%"],[2,"width","15%"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"spinner-border","spinner-border-sm","mr-1"],[2,"white-space","nowrap"],[1,"div-delete"],[1,"btn","btn-sm","btn-primary","mr-1",3,"routerLink","disabled"],["class","div-delete ms-1",4,"ngIf"],["class","div-delete  ms-1",4,"ngIf"],[1,"div-delete","ms-1"],[1,"btn","btn-sm","btn-danger","btn-delete-account",3,"disabled","click"],["class","spinner-border spinner-border-sm",4,"ngIf"],[1,"spinner-border","spinner-border-sm"],["colspan","4",1,"text-center"],[1,"spinner-border","spinner-border-lg","align-center"]],template:function(n,i){if(1&n){const a=e.EpF();e.TgZ(0,"h1"),e._uU(1,"Accounts Auto Email"),e.qZA(),e.TgZ(2,"div",0)(3,"div",1)(4,"div",2)(5,"input",3,4),e.NdJ("click",function(l){e.CHM(a);const f=e.MAs(6);return e.KtG(i.onChangeHandler(l,f))}),e.qZA(),e._uU(7,"\xa0Send e-mails: "),e.qZA()()(),e.TgZ(8,"h1"),e._uU(9,"Accounts"),e.qZA(),e.TgZ(10,"p"),e._uU(11,"All accounts from secure (admin only) api end point:"),e.qZA(),e.TgZ(12,"div",0)(13,"div",1)(14,"div",5)(15,"a",6),e._uU(16,"Create Account"),e.qZA()(),e.TgZ(17,"div",5)(18,"a",7),e._uU(19,"Upload Accounts"),e.qZA()(),e.TgZ(20,"div",5)(21,"a",8),e._uU(22,"Create\\View Schedules"),e.qZA()(),e.TgZ(23,"div",5)(24,"a",9),e._uU(25,"Generate Schedules"),e.qZA()(),e.TgZ(26,"div",5)(27,"a",10),e.NdJ("click",function(l){return i.onDeleteAllUserAccounts(l)}),e.YNc(28,ae,1,0,"span",11),e._uU(29," Delete Accounts "),e.qZA()()()(),e.TgZ(30,"table",12)(31,"thead")(32,"tr")(33,"th",13),e._uU(34,"Name"),e.qZA(),e.TgZ(35,"th",13),e._UZ(36,"img",14),e._uU(37," Email "),e.qZA(),e.TgZ(38,"th",15),e._uU(39,"DOB"),e.qZA(),e.TgZ(40,"th",15),e._uU(41,"Role"),e.qZA(),e._UZ(42,"th",16),e.qZA()(),e.TgZ(43,"tbody"),e.YNc(44,de,20,13,"tr",17)(45,me,3,0,"tr",18),e.qZA()()}2&n&&(e.xp6(5),e.Q6J("checked",i.autoEmail)("disabled",!1),e.xp6(23),e.Q6J("ngIf",i.isDeleting),e.xp6(16),e.Q6J("ngForOf",i.accounts),e.xp6(1),e.Q6J("ngIf",!i.accounts))},dependencies:[m.sg,m.O5,g.rH],styles:[".div-delete[_ngcontent-%COMP%]{float:left}"]})}return r})();var C=d(8540);const he=["paginator"];function fe(r,o){if(1&r&&(e.TgZ(0,"option",23),e._uU(1),e.qZA()),2&r){const t=o.$implicit,n=e.oxw();e.Q6J("value",t.lastName+"/"+t.firstName+"/"+t.email+"/"+t.dob+"/"+n.getGroup(t)),e.xp6(1),e.xDo(" ",t.lastName,"/",t.firstName,"/",t.email,"/",t.dob,"/",n.getGroup(t)," ")}}function ge(r,o){1&r&&(e.TgZ(0,"mat-header-cell",24),e._uU(1," First Name "),e.qZA())}function _e(r,o){if(1&r&&(e.TgZ(0,"mat-cell"),e._UZ(1,"input",25),e.qZA()),2&r){const t=o.$implicit;e.xp6(1),e.Q6J("value",t.firstName)}}function be(r,o){1&r&&(e.TgZ(0,"mat-header-cell",24),e._uU(1," Second Name "),e.qZA())}function ve(r,o){if(1&r&&(e.TgZ(0,"mat-cell"),e._UZ(1,"input",25),e.qZA()),2&r){const t=o.$implicit;e.xp6(1),e.Q6J("value",t.lastName)}}function Se(r,o){1&r&&(e.TgZ(0,"mat-header-cell",24),e._uU(1," E-mail "),e.qZA())}function Ce(r,o){if(1&r&&(e.TgZ(0,"mat-cell"),e._UZ(1,"input",25),e.qZA()),2&r){const t=o.$implicit;e.xp6(1),e.Q6J("value",t.email)}}function Ae(r,o){1&r&&(e.TgZ(0,"mat-header-cell",24),e._uU(1," Group "),e.qZA())}function xe(r,o){if(1&r&&(e.TgZ(0,"mat-cell"),e._UZ(1,"input",25),e.qZA()),2&r){const t=o.$implicit,n=e.oxw();e.xp6(1),e.Q6J("value",n.getGroup(t))}}function Te(r,o){1&r&&(e.TgZ(0,"mat-header-cell"),e._uU(1," Action "),e.qZA())}function ye(r,o){1&r&&e._UZ(0,"span",27)}const E=r=>({disabled:r});function Fe(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"mat-cell")(1,"button",26),e.NdJ("click",function(i){const s=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.onDeleteSchedule(i,s))}),e.YNc(2,ye,1,0,"span",22),e._uU(3," Delete "),e.qZA()()}if(2&r){const t=o.$implicit;e.xp6(1),e.Q6J("ngClass",e.VKq(2,E,t.isDeleting)),e.xp6(1),e.Q6J("ngIf",t.isDeleting)}}function Ze(r,o){1&r&&e._UZ(0,"mat-header-row")}const De=(r,o)=>({hovered:r,highlighted:o});function Me(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"mat-row",28,29),e.NdJ("click",function(){const i=e.CHM(t),a=i.$implicit,s=i.index,l=e.MAs(1),f=e.oxw();return e.KtG(f.onRowSelected(a,l,s))})("mouseover",function(){const a=e.CHM(t).$implicit;return e.KtG(a.hovered=!0)})("mouseout",function(){const a=e.CHM(t).$implicit;return e.KtG(a.hovered=!1)}),e.qZA()}if(2&r){const t=o.$implicit;e.Q6J("ngClass",e.WLB(1,De,t.hovered,t.highlighted))}}function we(r,o){1&r&&e._UZ(0,"span",27)}const Ue=()=>[5,10,30,50],G=[{key:"firstName",type:"text",label:"First Name"},{key:"secondName",type:"text",label:"SecondName"},{key:"email",type:"text",label:"E-mail"},{key:"group",type:"text",label:"ScheduleGroup"},{key:"action",type:"button",label:"Action"}];let ke=(()=>{class r{get accounts4DateAndFunction(){return this._accounts4DateAndFunction}set accounts4DateAndFunction(t){this._accounts4DateAndFunction=t}constructor(t,n,i,a,s){this.accountService=t,this.route=n,this.router=i,this.formBuilder=a,this.alertService=s,this.dateFormat=p.g.dateFormat,this.dateTimeFormat=p.g.dateTimeFormat,this.accountsAvailable4Function=[],this.displayedColumns=G.map(l=>l.key),this.columnsSchema=G,this.isAdding=!1,this.accountsLoaded=!0,this.dataSource=new u.by([]),this.currentSelectedAccount=null,this.lastSelectedAccount=null,this.accounts=[],this._accounts4DateAndFunction=[],this.titlePrefix="",this.schedulesUpdatedEmitter=new e.vpe}ngOnInit(){this.form=this.formBuilder.group({selectedUser:["",[c.kI.required]]})}setCurrentDate(t){if(this.dateTimeStr=t,console.log("Called for: for:"+this.functionStr+" New datetime is:"+t),this.loadAccounts4DateAndFunction(),this.accounts4DateAndFunction.length>0){var n=this.getGroup(this.accounts4DateAndFunction[0]);this.loadAccounts4Function(n),console.log("setCurrentDate"+this.accounts4DateAndFunction)}}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource=new u.by,this.refreshAccounts()}refreshAccounts(){this.accountsLoaded=!1,this.accountService.getAll().pipe((0,h.P)()).subscribe({next:t=>{if(this.accountsAvailable4Function=[],this.accounts=t,this.loadAccounts4Function(null),this.accounts.forEach(a=>{a.isDeleting=!1}),void 0!==this.selectedAccount4Function){var n=this.selectedAccount4Function.lastName+"/"+this.selectedAccount4Function.firstName+"/"+this.selectedAccount4Function.email+"/"+this.selectedAccount4Function.dob+"/"+this.getGroup(this.selectedAccount4Function);this.f.selectedUser.setValue(n)}else this.accountsAvailable4Function.length>0&&(n=this.accountsAvailable4Function[0].lastName+"/"+this.accountsAvailable4Function[0].firstName+"/"+this.accountsAvailable4Function[0].email+"/"+this.accountsAvailable4Function[0].dob+"/"+this.getGroup(this.accountsAvailable4Function[0]),this.f.selectedUser.setValue(n),this.selectedAccount4Function=this.accountsAvailable4Function[0]);this.loadAccounts4DateAndFunction(),this.schedulesUpdatedEmitter.emit({userFunction:this.functionStr,accounts:this.accounts4DateAndFunction}),this.accountService.getGroupTasks().pipe((0,h.P)()).subscribe({next:a=>{a.includes(this.functionStr)&&(this.titlePrefix="Group ")},complete:()=>{this.isAdding=!1},error:a=>{this.alertService.error(a),this.isAdding=!1}})},complete:()=>{this.accountsLoaded=!0},error:t=>{this.alertService.error(t),this.accountsLoaded=!0}})}loadAccounts4Function(t){this.accountsAvailable4Function=[],this.accounts.forEach(n=>{n.userFunctions.forEach(i=>{i.userFunction==this.functionStr&&(null==t||i.group==t)&&this.accountsAvailable4Function.push(n)})})}loadAccounts4DateAndFunction(){this.accounts4DateAndFunction=[],this.accounts.forEach(t=>{t.schedules.forEach(n=>{n.userFunction==this.functionStr&&n.date==this.dateTimeStr&&this.accounts4DateAndFunction.push(t)})}),this.dataSource=new u.by(this.accounts4DateAndFunction),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}get f(){return this.form.controls}getGroup(t){return t.userFunctions.find(n=>n.userFunction==this.functionStr).group}onChangeUser(t){var i=t.target.value.split("/");this.selectedAccount4Function=this.accountsAvailable4Function.find(a=>a.email===i[2]&&a.dob===i[3])}onApplyFilter(t,n){var a=t.value;a=(a=a.trim()).toLowerCase(),this.dataSource.filter=a}onAddSchedule(t,n){this.addSchedule(this.selectedAccount4Function)}addSchedule(t){var n={accountId:t.id,date:this.dateTimeStr,newDate:this.dateTimeStr,dob:t.dob,required:!0,deleting:!1,userAvailability:!0,scheduleGroup:t.scheduleGroup,userFunction:this.functionStr,newUserFunction:this.functionStr};this.isAdding=!0,this.accountService.addSchedule(t.id,n).pipe((0,h.P)()).subscribe({next:i=>{this.refreshAccounts()},complete:()=>{this.isAdding=!1},error:i=>{this.refreshAccounts(),this.alertService.error(i),this.isAdding=!1}})}onDeleteSchedules(t){this.accounts4DateAndFunction.forEach(n=>{console.log("FunctionScheduleComponent deleting functionStr:"+this.functionStr+" dateStr:"+this.dateTimeStr),this.onDeleteSchedule(t,n)})}onDeleteSchedule(t,n){n.isDeleting=!0,this.accountService.deleteSchedule(n.id,{accountId:n.id,date:this.dateTimeStr,newDate:this.dateTimeStr,dob:n.dob,required:!0,deleting:!1,userAvailability:!0,scheduleGroup:n.scheduleGroup,userFunction:this.functionStr,newUserFunction:this.functionStr}).pipe((0,h.P)()).subscribe({next:a=>{console.log("FunctionScheduleComponent functionStr:"+this.functionStr+" dateStr:"+this.dateTimeStr+" deleted"),this.refreshAccounts()},complete:()=>{},error:a=>{this.alertService.error(a),this.refreshAccounts()}})}onRowSelected(t,n,i){t.highlighted=!t.highlighted,this.currentSelectedAccount=t,null!=this.lastSelectedAccount&&(this.lastSelectedAccount.highlighted=!1),this.lastSelectedAccount=this.currentSelectedAccount,t.highlighted||(this.lastSelectedAccount=null,this.currentSelectedAccount=null)}static#e=this.\u0275fac=function(n){return new(n||r)(e.Y36(_.B),e.Y36(g.gz),e.Y36(g.F0),e.Y36(c.qu),e.Y36(_.c))};static#t=this.\u0275cmp=e.Xpm({type:r,selectors:[["app-function-schedule"]],viewQuery:function(n,i){if(1&n&&(e.Gf(he,5),e.Gf(S.YE,5)),2&n){let a;e.iGM(a=e.CRH())&&(i.paginator=a.first),e.iGM(a=e.CRH())&&(i.sort=a.first)}},inputs:{functionStr:"functionStr",dateTimeStr:"dateTimeStr"},outputs:{schedulesUpdatedEmitter:"schedulesUpdatedEmitter"},decls:34,vars:15,consts:[[3,"formGroup"],[1,"row","mb-4"],[1,"col-5"],["formControlName","selectedUser",1,"form-select",3,"change"],["element",""],[3,"value",4,"ngFor","ngForOf"],["matSort","",3,"dataSource"],["table",""],["matColumnDef","firstName"],["mat-sort-header","",4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","secondName"],["matColumnDef","email"],["matColumnDef","group"],["matColumnDef","action"],[4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[3,"ngClass","click","mouseover","mouseout",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"length","pageSizeOptions"],["paginator",""],["type","button",1,"btn","btn-primary",3,"ngClass","click"],["button",""],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],[3,"value"],["mat-sort-header",""],["type","text","matInput","","readonly","",3,"value"],["type","button",1,"btn","btn-sm","btn-danger","btn-delete-account",3,"ngClass","click"],[1,"spinner-border","spinner-border-sm","mr-1"],[3,"ngClass","click","mouseover","mouseout"],["tr",""]],template:function(n,i){if(1&n){const a=e.EpF();e.TgZ(0,"fieldset")(1,"legend"),e._uU(2),e.qZA(),e.TgZ(3,"form",0)(4,"div",1)(5,"div",2)(6,"select",3,4),e.NdJ("change",function(l){return i.onChangeUser(l)}),e.YNc(8,fe,2,6,"option",5),e.qZA()()()(),e.TgZ(9,"mat-table",6,7),e.ynx(11,8),e.YNc(12,ge,2,0,"mat-header-cell",9)(13,_e,2,1,"mat-cell",10),e.BQk(),e.ynx(14,11),e.YNc(15,be,2,0,"mat-header-cell",9)(16,ve,2,1,"mat-cell",10),e.BQk(),e.ynx(17,12),e.YNc(18,Se,2,0,"mat-header-cell",9)(19,Ce,2,1,"mat-cell",10),e.BQk(),e.ynx(20,13),e.YNc(21,Ae,2,0,"mat-header-cell",9)(22,xe,2,1,"mat-cell",10),e.BQk(),e.ynx(23,14),e.YNc(24,Te,2,0,"mat-header-cell",15)(25,Fe,4,4,"mat-cell",10),e.BQk(),e.YNc(26,Ze,1,0,"mat-header-row",16)(27,Me,2,4,"mat-row",17),e.qZA(),e._UZ(28,"mat-paginator",18,19),e.TgZ(30,"button",20,21),e.NdJ("click",function(l){e.CHM(a);const f=e.MAs(31);return e.KtG(i.onAddSchedule(l,f))}),e.YNc(32,we,1,0,"span",22),e._uU(33),e.qZA()()}2&n&&(e.xp6(2),e.AsE("",i.titlePrefix,"",i.functionStr,""),e.xp6(1),e.Q6J("formGroup",i.form),e.xp6(5),e.Q6J("ngForOf",i.accountsAvailable4Function),e.xp6(1),e.Q6J("dataSource",i.dataSource),e.xp6(17),e.Q6J("matHeaderRowDef",i.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",i.displayedColumns),e.xp6(1),e.Q6J("length",i.accounts4DateAndFunction.length)("pageSizeOptions",e.DdM(12,Ue)),e.xp6(2),e.Q6J("ngClass",e.VKq(13,E,i.accountsAvailable4Function.length<=0)),e.xp6(2),e.Q6J("ngIf",i.isAdding),e.xp6(1),e.hij(" Add ",i.functionStr," "))},dependencies:[m.mk,m.sg,m.O5,c._Y,c.YN,c.Kr,c.EJ,c.JJ,c.JL,c.sg,c.u,u.BZ,u.fO,u.as,u.w1,u.Dz,u.nj,u.ge,u.ev,u.XQ,u.Gk,S.YE,S.nU,y.NW,F.Nt],styles:[".highlighted[_ngcontent-%COMP%], .mat-mdc-table[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]:hover, .mat-mdc-table[_ngcontent-%COMP%]   .mat-mdc-footer-row[_ngcontent-%COMP%]:hover{background:var(--bg-color)}[_nghost-%COMP%]{--bg-color: rgba(100, 100, 100, .5)}fieldset[_ngcontent-%COMP%]{margin:8px;border:4px solid silver;padding:8px;border-radius:4px}legend[_ngcontent-%COMP%]{font-size:small;background-color:#000;color:#fff;padding:3px 6px}"]})}return r})();var Ne=d(2810);const qe=["ref"],Je=["function"];function Ee(r,o){1&r&&(e.TgZ(0,"div",19),e._UZ(1,"span",20),e.qZA())}function Ge(r,o){1&r&&(e.TgZ(0,"mat-error"),e._uU(1,"Invalid DOB"),e.qZA())}function Ie(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"div")(1,"app-function-schedule",21,22),e.NdJ("schedulesUpdatedEmitter",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onSchedulesUpdated(i))}),e.qZA()()}if(2&r){const t=o.$implicit,n=e.oxw();e.xp6(1),e.Q6J("functionStr",t.userFunction)("dateTimeStr",n.getDateTimeStr())}}const I=r=>({disabled:r});class b{static#e=this.functions2SchedulesMap=new Map;constructor(o,t,n,i,a){this.accountService=o,this.route=t,this.router=n,this.formBuilder=i,this.alertService=a,this.dateFormat=p.g.dateFormat,this.dateTimeFormat=p.g.dateTimeFormat,this.functions=[],this.fComponents=[],this.functionsLoaded=!0,this.enableCopyButton=!1,this.enablePasteButton=!1,this.schedulesUpdatedEmitter=new e.vpe,this.dateTimeChangedEmitter=new e.vpe}ngAfterViewInit(){this.functionComponents.changes.subscribe(o=>{o.forEach(n=>{this.fComponents.push(n)});var t=new Map(b.functions2SchedulesMap);b.functions2SchedulesMap.clear();for(let n of t.entries())console.log("Key:"+n[0].dateTimeStr),this.fComponents.forEach(i=>{i.functionStr===n[0].functionStr&&b.functions2SchedulesMap.set(i,n[1])})})}ngOnInit(){this.form=this.formBuilder.group({scheduledDateTime:[new Date,c.kI.required],information:[,c.kI.required]}),this.functionsLoaded=!1,this.accountService.getTasks().pipe((0,h.P)()).subscribe({next:o=>{o.forEach(t=>{this.functions.push({id:"",userFunction:t,group:""})})},complete:()=>{this.functionsLoaded=!0},error:o=>{this.alertService.error(o),this.functionsLoaded=!1}}),this.setCopyPasteButtons()}onSchedulesUpdated(o){this.setCopyPasteButtons(),this.schedulesUpdatedEmitter.emit(o)}onChangeDateTime(o){this.fComponents.forEach(t=>{console.log("Changing time to: "+this.getDateTimeStr()),t.setCurrentDate(this.getDateTimeStr())}),this.setCopyPasteButtons(),this.dateTimeChangedEmitter.emit(C(o.value).format(this.dateTimeFormat))}get f(){return this.form.controls}getDateTimeStr(){return C(this.f.scheduledDateTime.value).format(this.dateTimeFormat)}setCurrentDate(o){this.f.scheduledDateTime.setValue(C(o,p.g.dateTimeFormat).toDate()),this.fComponents.forEach(t=>{console.log("Changing time to: "+this.getDateTimeStr()),t.setCurrentDate(this.getDateTimeStr())}),this.setCopyPasteButtons(),console.log("Generate changing date: "+o)}onCopy(o,t){var n=this.copyChildData();return this.setCopyPasteButtons(),n}onPaste(o,t){this.setCopyPasteButtons();for(let n of b.functions2SchedulesMap.entries()){console.log("Key:"+n[0].dateTimeStr);for(let i=0;i<n[1].length;i++)console.log("\tValue:"+n[1][i].firstName),n[0].addSchedule(n[1][i])}}onClear(o,t){b.functions2SchedulesMap.clear(),this.setCopyPasteButtons()}onDeleteSchedules(o,t){this.fComponents.forEach(n=>{this.setCurrentDate(t.date),n.onDeleteSchedules(o),console.log("GenerateSchedulesComponent deleting functionStr:"+n.functionStr+" dateStr:"+n.dateTimeStr)})}copyChildData(){return b.functions2SchedulesMap.clear(),this.fComponents.forEach(o=>{b.functions2SchedulesMap.set(o,o.accounts4DateAndFunction)}),b.functions2SchedulesMap}childrenData(){var o=new Map;return this.fComponents.forEach(t=>{t.accounts4DateAndFunction.length>0&&o.set(t.functionStr,t.accounts4DateAndFunction)}),o}areChildrenEmpty(){return this.childrenData().size<=0}isFunc2SchedMapdEmpty(){return b.functions2SchedulesMap.size<=0}setCopyPasteButtons(){this.isFunc2SchedMapdEmpty()?this.f.information.setValue("There is no data in a buffer"):this.f.information.setValue("There is data in a buffer"),this.areChildrenEmpty()?(this.enableCopyButton=!1,this.enablePasteButton=!this.isFunc2SchedMapdEmpty()):(this.enableCopyButton=!0,this.enablePasteButton=!1)}static#t=this.\u0275fac=function(t){return new(t||b)(e.Y36(_.B),e.Y36(g.gz),e.Y36(g.F0),e.Y36(c.qu),e.Y36(_.c))};static#n=this.\u0275cmp=e.Xpm({type:b,selectors:[["app-generate-schedules"]],viewQuery:function(t,n){if(1&t&&(e.Gf(qe,5),e.Gf(Je,5)),2&t){let i;e.iGM(i=e.CRH())&&(n.dateCtrl=i.first),e.iGM(i=e.CRH())&&(n.functionComponents=i)}},outputs:{schedulesUpdatedEmitter:"schedulesUpdatedEmitter",dateTimeChangedEmitter:"dateTimeChangedEmitter"},decls:36,vars:27,consts:[["class","d-flex justify-content-center",4,"ngIf"],[1,"mb-3"],[3,"formGroup"],[1,"row"],[1,"col-3"],["appearance","outline"],["id","test","formControlName","scheduledDateTime","matInput","","placeholder","Choose a date","required","",3,"ngxMatDatetimePicker","dateChange"],["ref",""],["matSuffix","",3,"for"],[3,"showSpinners","showSeconds","stepHour","stepMinute","stepSecond","touchUi","color","enableMeridian","disableMinute","hideTime"],["picker",""],[4,"ngIf"],[1,"col-2"],["type","button",1,"btn","btn-primary",3,"ngClass","click"],["button",""],["type","button",1,"btn","btn-primary",3,"click"],["type","text","formControlName","information","id","Info","name","Name",1,"no-outline"],[1,"mb-3","mx-0"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center"],[1,"spinner-border","spinner-border-lg","align-center"],[3,"functionStr","dateTimeStr","schedulesUpdatedEmitter"],["function",""]],template:function(t,n){if(1&t){const i=e.EpF();e.YNc(0,Ee,2,0,"div",0),e.TgZ(1,"fieldset")(2,"legend"),e._uU(3,"View/Edit Schedule:"),e.qZA(),e.TgZ(4,"div",1)(5,"form",2)(6,"div",3)(7,"div",4)(8,"mat-form-field",5)(9,"mat-label"),e._uU(10,"Schedule"),e.qZA(),e.TgZ(11,"input",6,7),e.NdJ("dateChange",function(s){return n.onChangeDateTime(s)}),e.qZA(),e._UZ(13,"mat-datepicker-toggle",8),e.TgZ(14,"mat-hint"),e._uU(15),e.qZA(),e._UZ(16,"ngx-mat-datetime-picker",9,10),e.YNc(18,Ge,2,0,"mat-error",11),e.qZA()(),e.TgZ(19,"div",12)(20,"button",13,14),e.NdJ("click",function(s){e.CHM(i);const l=e.MAs(21);return e.KtG(n.onCopy(s,l))}),e._uU(22," Copy To Buffer "),e.qZA()(),e.TgZ(23,"div",12)(24,"button",13,14),e.NdJ("click",function(s){e.CHM(i);const l=e.MAs(21);return e.KtG(n.onPaste(s,l))}),e._uU(26," Paste From Buffer "),e.qZA()(),e.TgZ(27,"div",12)(28,"button",15,14),e.NdJ("click",function(s){e.CHM(i);const l=e.MAs(21);return e.KtG(n.onClear(s,l))}),e._uU(30," Clear Buffer "),e.qZA()(),e.TgZ(31,"div",4),e._UZ(32,"input",16),e.qZA()()()(),e.TgZ(33,"div",17),e.YNc(34,Ie,3,2,"div",18),e.ALo(35,"orderByDate"),e.qZA()()}if(2&t){const i=e.MAs(17);e.Q6J("ngIf",!n.functionsLoaded),e.xp6(5),e.Q6J("formGroup",n.form),e.xp6(6),e.Q6J("ngxMatDatetimePicker",i),e.xp6(2),e.Q6J("for",i),e.xp6(2),e.Oqu(n.dateFormat),e.xp6(1),e.Q6J("showSpinners",!0)("showSeconds",!1)("stepHour",1)("stepMinute",1)("stepSecond",0)("touchUi",!1)("color",void 0)("enableMeridian",!1)("disableMinute",!1)("hideTime",!1),e.xp6(2),e.Q6J("ngIf",n.f.scheduledDateTime.errors),e.xp6(2),e.Q6J("ngClass",e.VKq(23,I,!n.enableCopyButton)),e.xp6(4),e.Q6J("ngClass",e.VKq(25,I,!n.enablePasteButton)),e.xp6(10),e.Q6J("ngForOf",e.Dn7(35,19,n.functions,"userFunction","asc"))}},dependencies:[m.mk,m.sg,m.O5,c._Y,c.Fj,c.JJ,c.JL,c.Q7,c.sg,c.u,M.nW,F.Nt,v.KE,v.hX,v.bx,v.TO,v.R9,T.rZ,T.T$,ke,Ne.o],styles:["progress[_ngcontent-%COMP%]{text-align:center;width:100%}fieldset[_ngcontent-%COMP%]{margin:8px;border:1px solid silver;padding:8px;border-radius:4px}legend[_ngcontent-%COMP%]{background-color:#000;color:#fff;padding:3px 6px}#Info[_ngcontent-%COMP%]{width:100%;border:none}"]})}const Pe=["scheduleDate"];function Oe(r,o){1&r&&(e.TgZ(0,"mat-header-cell",25),e._uU(1," Date "),e.qZA())}function Qe(r,o){if(1&r&&(e.TgZ(0,"mat-cell"),e._UZ(1,"input",26),e.qZA()),2&r){const t=o.$implicit;e.xp6(1),e.Q6J("value",t.date)}}function Be(r,o){1&r&&(e.TgZ(0,"mat-header-cell",25),e._uU(1," Day "),e.qZA())}function Ye(r,o){if(1&r&&(e.TgZ(0,"mat-cell"),e._UZ(1,"input",26),e.qZA()),2&r){const t=o.$implicit;e.xp6(1),e.Q6J("value",t.day)}}function Le(r,o){1&r&&(e.TgZ(0,"mat-header-cell",25),e._uU(1," Delete "),e.qZA())}function Re(r,o){1&r&&e._UZ(0,"span",30)}const He=r=>({disabled:r});function Ve(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"mat-cell")(1,"button",27,28),e.NdJ("click",function(i){const s=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.onDeleteSchedules(i,s))}),e.YNc(3,Re,1,0,"span",29),e._uU(4," Delete "),e.qZA()()}if(2&r){const t=o.$implicit;e.xp6(1),e.Q6J("ngClass",e.VKq(2,He,t.isDeleting)),e.xp6(2),e.Q6J("ngIf",t.isDeleting)}}function Ke(r,o){1&r&&e._UZ(0,"mat-header-row")}const $e=(r,o)=>({hovered:r,highlighted:o});function Xe(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"mat-row",31,32),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.onRowSelected(a))})("mouseover",function(){const a=e.CHM(t).$implicit;return e.KtG(a.hovered=!0)})("mouseout",function(){const a=e.CHM(t).$implicit;return e.KtG(a.hovered=!1)}),e.qZA()}if(2&r){const t=o.$implicit;e.Q6J("ngClass",e.WLB(1,$e,t.hovered,t.highlighted))}}const ze=()=>[5,10,20,50,100],P=[{key:"date",type:"text",label:"Date"},{key:"day",type:"text",label:"Day"},{key:"delete",type:"text",label:"Delete"}];let je=(()=>{class r{constructor(t,n){this.accountService=t,this.formBuilder=n,this.list=[],this.futureScheduleDateStrings=[],this.isLoaded=!1,this.isUsersLoaded=!1,this.scheduleDateTime=[],this.displayedColumns=P.map(i=>i.key),this.columnsSchema=P,this.dataSource=new u.by,this.currentSelectedAccount=null,this.lastSelectedAccount=null,this.futureScheduleDates=[]}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource=new u.by,this.getAllDates()}ngOnInit(){this.form=this.formBuilder.group({dates:["",[c.kI.required,this.dateValidator]],allDates:[!0,""]})}onCheckboxChange(t){this.getAllDates()}get f(){return this.form.controls}getAllDates(){this.accountService.getAllDates().pipe((0,h.P)()).subscribe({next:t=>{this.futureScheduleDateStrings=[],this.list=[],this.futureScheduleDates=[],this.scheduleDateTime=t.scheduleDateTimes,console.assert(this.list.length<=0,"list not empty");for(let l=0;l<t.scheduleDateTimes.length;l++)this.list.push(t.scheduleDateTimes[l]);this.list.sort(function(l,f){var A=C(l.date,p.g.dateTimeFormat).toDate(),Z=C(f.date,p.g.dateTimeFormat).toDate();return A>Z?1:A<Z?-1:0});for(let l=0;l<this.list.length;l++){var n=Date.now();const f=C(this.list[l].date).toDate();var i=C(f).format(p.g.dateTimeFormat),a=f.getTime();if(this.f.allDates.value||a>n){this.futureScheduleDateStrings.push(i+"/"+this.getDayStrFromDate(i));var s={id:"",date:i,highlighted:!1,isDeleting:!1,day:this.getDayStrFromDate(i)};this.futureScheduleDates.push(s)}}this.dataSource=new u.by(this.futureScheduleDates),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.isLoaded=!0},error:t=>{console.log()}})}getDayStrFromDate(t){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][C(t,p.g.dateTimeFormat).toDate().getDay()]}dateValidator(t){return t.value.match(/^\d/)?null:{invalidDate:!0}}onSchedulesUpdated(t){this.getAllDates()}onRowSelected(t){console.log("MainSchedulerComponent row selected");var n=!1;for(let i=0;i<this.futureScheduleDates.length;i++){const a=this.futureScheduleDates[i];if(t.date===a.date){n=!0,this.currentSelectedAccount=a;break}}this.currentSelectedAccount&&(this.currentSelectedAccount.highlighted=!this.currentSelectedAccount.highlighted,n||(this.currentSelectedAccount.highlighted=!1),n&&this.generateScheduleComponent.setCurrentDate(this.currentSelectedAccount.date)),null!=this.lastSelectedAccount&&(this.lastSelectedAccount.highlighted=!1),this.lastSelectedAccount=this.currentSelectedAccount,this.currentSelectedAccount&&!this.currentSelectedAccount.highlighted&&(this.lastSelectedAccount=null,this.currentSelectedAccount=null)}dateTimeChanged(t){var n={id:"",date:t,highlighted:!1,isDeleting:!1,day:this.getDayStrFromDate(t)};this.onRowSelected(n)}onDeleteSchedules(t,n){console.log("MainSchedulerComponent deleting called"),n.isDeleting=!0,this.generateScheduleComponent.onDeleteSchedules(t,n)}static#e=this.\u0275fac=function(n){return new(n||r)(e.Y36(_.B),e.Y36(c.qu))};static#t=this.\u0275cmp=e.Xpm({type:r,selectors:[["app-main-scheduler"]],viewQuery:function(n,i){if(1&n&&(e.Gf(y.NW,5),e.Gf(S.YE,5),e.Gf(Pe,5)),2&n){let a;e.iGM(a=e.CRH())&&(i.paginator=a.first),e.iGM(a=e.CRH())&&(i.sort=a.first),e.iGM(a=e.CRH())&&(i.generateScheduleComponent=a.first)}},decls:39,vars:7,consts:[[1,"container-fluid"],[3,"formGroup"],[1,"col","mx-md-2"],["routerLink","../",1,"btn","btn-primary"],[1,"row"],[1,"col-12"],[2,"overflow","auto"],[1,"ml-3"],["for","dates",1,"me-2"],["type","checkbox","checked","","formControlName","allDates","id","allDates","name","allDates","value","",1,"ms-5",3,"change"],["for","allDates",1,"ps-2"],["matSort","",2,"min-width","800px",3,"dataSource"],["table",""],["matColumnDef","date"],["mat-sort-header","",4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","day"],["matColumnDef","delete"],[4,"matHeaderRowDef"],[3,"ngClass","click","mouseover","mouseout",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"length","pageSizeOptions"],["paginator",""],[3,"dateTimeChangedEmitter","schedulesUpdatedEmitter"],["scheduleDate",""],[1,"col","px-md-2"],["mat-sort-header",""],["type","text","matInput","","readonly","",3,"value"],["type","button",1,"btn","btn-sm","btn-danger","btn-delete-account",3,"ngClass","click"],["button",""],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],[1,"spinner-border","spinner-border-sm","mr-1"],[3,"ngClass","click","mouseover","mouseout"],["tr",""]],template:function(n,i){1&n&&(e.TgZ(0,"div",0)(1,"form",1)(2,"div",2)(3,"a",3),e._uU(4,"Back"),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5)(7,"fieldset",6)(8,"legend"),e._uU(9,"Schedules"),e.qZA(),e.TgZ(10,"div",7)(11,"label",8),e._uU(12,"Dates:"),e.qZA(),e.TgZ(13,"input",9),e.NdJ("change",function(s){return i.onCheckboxChange(s)}),e.qZA(),e.TgZ(14,"label",10),e._uU(15,"All"),e.qZA(),e._UZ(16,"br"),e.qZA(),e.TgZ(17,"mat-table",11,12),e.ynx(19,13),e.YNc(20,Oe,2,0,"mat-header-cell",14)(21,Qe,2,1,"mat-cell",15),e.BQk(),e.ynx(22,16),e.YNc(23,Be,2,0,"mat-header-cell",14)(24,Ye,2,1,"mat-cell",15),e.BQk(),e.ynx(25,17),e.YNc(26,Le,2,0,"mat-header-cell",14)(27,Ve,5,4,"mat-cell",15),e.BQk(),e.YNc(28,Ke,1,0,"mat-header-row",18)(29,Xe,2,4,"mat-row",19),e.qZA(),e._UZ(30,"mat-paginator",20,21),e.qZA()()(),e.TgZ(32,"div",4)(33,"div",5)(34,"app-generate-schedules",22,23),e.NdJ("dateTimeChangedEmitter",function(s){return i.dateTimeChanged(s)})("schedulesUpdatedEmitter",function(s){return i.onSchedulesUpdated(s)}),e.qZA()()(),e.TgZ(36,"div",24)(37,"a",3),e._uU(38,"Back"),e.qZA()()()()),2&n&&(e.xp6(1),e.Q6J("formGroup",i.form),e.xp6(16),e.Q6J("dataSource",i.dataSource),e.xp6(11),e.Q6J("matHeaderRowDef",i.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",i.displayedColumns),e.xp6(1),e.Q6J("length",i.futureScheduleDateStrings.length)("pageSizeOptions",e.DdM(6,ze)))},dependencies:[m.mk,m.O5,c._Y,c.Wl,c.JJ,c.JL,c.sg,c.u,g.rH,u.BZ,u.fO,u.as,u.w1,u.Dz,u.nj,u.ge,u.ev,u.XQ,u.Gk,S.YE,S.nU,y.NW,F.Nt,b],styles:["app-generate-schedules[_ngcontent-%COMP%]{width:100%}#designer-host[_ngcontent-%COMP%]{width:100%;height:100vh}.highlighted[_ngcontent-%COMP%], .mat-mdc-table[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]:hover, .mat-mdc-table[_ngcontent-%COMP%]   .mat-mdc-footer-row[_ngcontent-%COMP%]:hover{background:var(--bg-color)}[_nghost-%COMP%]{--bg-color: rgba(100, 100, 100, .5)}fieldset[_ngcontent-%COMP%]{margin:8px;border:4px solid silver;padding:8px;border-radius:4px}legend[_ngcontent-%COMP%]{background-color:#000;color:#fff;padding:3px 6px}"]})}return r})();var We=d(553),et=d(7028),tt=d(5474);const nt=["paginator"];function rt(r,o){1&r&&(e.TgZ(0,"mat-error"),e._uU(1,"Invalid DOB"),e.qZA())}function it(r,o){if(1&r&&(e.TgZ(0,"mat-option",38),e._uU(1),e.qZA()),2&r){const t=o.$implicit;e.Q6J("value",t.userFunction),e.xp6(1),e.hij(" ",t.userFunction," ")}}function ot(r,o){1&r&&(e.TgZ(0,"mat-error",39),e._uU(1," Duty can't be empty "),e.qZA())}function at(r,o){1&r&&(e.TgZ(0,"mat-error"),e._uU(1,"The field is required"),e.qZA())}function st(r,o){if(1&r&&(e.TgZ(0,"div",32)(1,"mat-form-field",2)(2,"mat-label"),e._uU(3,"Team"),e.qZA(),e._UZ(4,"input",40,41),e.YNc(6,at,2,0,"mat-error",30),e.qZA()()),2&r){const t=e.oxw(2);e.xp6(4),e.Q6J("readonly",t.isReadOnly),e.xp6(2),e.Q6J("ngIf",t.f.cleanerGroup.enabled&&t.f.cleanerGroup.hasError("required"))}}function ct(r,o){1&r&&e._UZ(0,"span",45)}const lt=r=>({disabled:r});function ut(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"div",42)(1,"button",43),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onAddSchedule())}),e.YNc(2,ct,1,0,"span",44),e._uU(3," Add "),e.qZA(),e._uU(4," \xa0 "),e.qZA()}if(2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("ngClass",e.VKq(2,lt,!t.form.controls.scheduledDate.valid)),e.xp6(1),e.Q6J("ngIf",t.isAdding)}}const dt=r=>({"is-invalid":r});function mt(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"form",21)(1,"div",22)(2,"div",23)(3,"label"),e._uU(4),e.qZA()()(),e.TgZ(5,"fieldset")(6,"legend"),e._uU(7,"Date & Duty:"),e.qZA(),e.TgZ(8,"div",1)(9,"div",22)(10,"div",24)(11,"mat-form-field",2)(12,"mat-label"),e._uU(13,"Schedule"),e.qZA(),e._UZ(14,"input",25,26)(16,"mat-datepicker-toggle",27),e.TgZ(17,"mat-hint"),e._uU(18),e.qZA(),e._UZ(19,"ngx-mat-datetime-picker",28,29),e.YNc(21,rt,2,0,"mat-error",30),e.qZA()()()(),e.TgZ(22,"div",1)(23,"div",31)(24,"div",32)(25,"mat-form-field",2)(26,"mat-label"),e._uU(27,"Duty"),e.qZA(),e.TgZ(28,"mat-select",33),e.NdJ("selectionChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onDutyChanged(i))}),e.YNc(29,it,2,2,"mat-option",34),e.qZA(),e.YNc(30,ot,2,0,"mat-error",35),e.qZA()(),e.YNc(31,st,7,2,"div",36),e.qZA()(),e.YNc(32,ut,5,4,"div",37),e.qZA()()}if(2&r){const t=e.MAs(20),n=e.oxw();e.Q6J("formGroup",n.form),e.xp6(4),e.AsE("Define schedules for ",n.account.firstName," ",n.account.lastName,""),e.xp6(10),e.Q6J("ngxMatDatetimePicker",t),e.xp6(2),e.Q6J("for",t),e.xp6(2),e.Oqu(n.dateFormat),e.xp6(1),e.Q6J("showSpinners",!0)("showSeconds",!1)("stepHour",1)("stepMinute",1)("stepSecond",0)("touchUi",!1)("color",void 0)("enableMeridian",!1)("disableMinute",!1)("hideTime",!1),e.xp6(2),e.Q6J("ngIf",n.f.scheduledDate.errors),e.xp6(7),e.Q6J("ngClass",e.VKq(22,dt,n.submitted&&n.f.function.errors)),e.xp6(1),e.Q6J("ngForOf",n.userFunctions),e.xp6(1),e.Q6J("ngIf",n.submitted&&n.form.controls.function.hasError("invalidFunction")),e.xp6(1),e.Q6J("ngIf",n.isCleaner),e.xp6(1),e.Q6J("ngIf",n.isLoggedAsAdmin)}}function pt(r,o){1&r&&(e.TgZ(0,"mat-header-cell",46),e._uU(1," Date "),e.qZA())}function ht(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"mat-cell")(1,"input",47),e.NdJ("dateChange",function(i){const s=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.onDateChanged(i,s))}),e.qZA()()}if(2&r){const t=o.$implicit;e.xp6(1),e.Q6J("value",t.date)}}function ft(r,o){1&r&&(e.TgZ(0,"mat-header-cell",46),e._uU(1," Duty "),e.qZA())}function gt(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"mat-cell")(1,"input",48,49),e.NdJ("selectionChange",function(i){const s=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.onUserFunctionChanged(i,s))}),e.qZA()()}if(2&r){const t=o.$implicit;e.xp6(1),e.Q6J("value",t.userFunction)}}function _t(r,o){1&r&&(e.TgZ(0,"mat-header-cell",46),e._uU(1," Team "),e.qZA())}function bt(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"span")(1,"input",50,49),e.NdJ("keydown.enter",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.onCleanerGroupPressed(i))}),e.qZA()()}}function vt(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"span")(1,"input",50,49),e.NdJ("keydown.enter",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.onCleanerGroupPressed(i))}),e.qZA()()}if(2&r){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("value",t.scheduleGroup)}}function St(r,o){if(1&r&&(e.TgZ(0,"mat-cell"),e.YNc(1,bt,3,0,"span",30)(2,vt,3,1,"span",30),e.qZA()),2&r){const t=o.$implicit;e.xp6(1),e.Q6J("ngIf",null==t.scheduleGroup),e.xp6(1),e.Q6J("ngIf",null!=t.scheduleGroup)}}function Ct(r,o){1&r&&(e.TgZ(0,"mat-header-cell"),e._uU(1," Action "),e.qZA())}function At(r,o){1&r&&e._UZ(0,"span",45)}function xt(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"mat-cell")(1,"button",51),e.NdJ("click",function(){const i=e.CHM(t),a=i.index,s=i.$implicit,l=e.oxw();return e.KtG(l.onDeleteSchedule(a,s))}),e.YNc(2,At,1,0,"span",44),e._uU(3,"Delete "),e.qZA()()}if(2&r){const t=o.$implicit;e.xp6(2),e.Q6J("ngIf",t.deleting)}}function Tt(r,o){1&r&&e._UZ(0,"mat-header-row")}const yt=(r,o)=>({hovered:r,highlighted:o});function Ft(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"mat-row",52,53),e.NdJ("click",function(){const i=e.CHM(t),a=i.$implicit,s=i.index,l=e.MAs(1),f=e.oxw();return e.KtG(f.onRowSelected(a,l,s))})("mouseover",function(){const a=e.CHM(t).$implicit;return e.KtG(a.hovered=!0)})("mouseout",function(){const a=e.CHM(t).$implicit;return e.KtG(a.hovered=!1)}),e.qZA()}if(2&r){const t=o.$implicit;e.Q6J("ngClass",e.WLB(1,yt,t.hovered,t.highlighted))}}const Zt=()=>[5,30,50,100],O=[{key:"date",type:"Date",label:"Date"},{key:"userFunction",type:"text",label:"Duty"},{key:"scheduleGroup",type:"text",label:"Group"},{key:"action",type:"button",label:"Action"}];let Dt=(()=>{class r{constructor(t,n,i,a,s,l,f){this.route=n,this.router=i,this.formBuilder=a,this.alertService=s,this.cdr=l,this.uppercasePipe=f,this.CLEANER_STR=p.g.CLEANER_STR,this.dateFormat=p.g.dateTimeFormat,this.dateTimeFormat=p.g.dateTimeFormat,this.schedules=[],this.userFunctionIndexer=0,this.functions=[],this.submitted=!1,this.isLoaded=!1,this.isAdding=!1,this.isUpdating=!1,this.displayedColumns=O.map(A=>A.key),this.columnsSchema=O,this.userFunctions=[],this.isLoggedAsAdmin=!1,this.currentSelectedSchedule=null,this.lastSelectedSchedule=null,this.poolElements=[],this.color="primary",this.groupTask="G",this.accountService=t,this.onScheduledAdded=new e.vpe,this.isLoggedAsAdmin=this.accountService.isAdmin(),this.connection=(new et.s).configureLogging(tt.i.Information).withUrl(We.N.baseUrl+"/update").build(),this.connection.start().then(function(){console.log("SignalR Connected!")}).catch(function(A){return console.error(A.toString())}),this.connection.on("SendUpdate",A=>{this.updateSchedulesFromServer()}),this.form=this.formBuilder.group({scheduledDate:["",c.kI.required],cleanerGroup:["K"],function:["",[c.kI.required,this.functionValidator]]})}ngAfterViewInit(){this.accountService.getById(this.id).pipe((0,h.P)()).subscribe(t=>{this.account=t,this.accountService.getTasks().pipe((0,h.P)()).subscribe({next:n=>{this.functions=n,this.initSchedules(t),this.sort.sort({id:"date",start:"asc"}),this.userFunctions=t.userFunctions.slice(),this.form.get("scheduledDate").setValue(new Date),this.userFunctions.length>0&&this.form.get("function").setValue(this.userFunctions[0].userFunction),this.isCleaner?(this.form.get("cleanerGroup").addValidators(c.kI.required),this.form.get("cleanerGroup").addValidators(c.kI.minLength(1)),this.form.get("cleanerGroup").setValue(t.scheduleGroup)):this.form.get("cleanerGroup").disable(),this.account=t,this.onScheduledAdded.emit(this.schedules),this.userFunctionIndexer=t.userFunctions.length>0?parseInt(t.userFunctions[t.userFunctions.length-1].id):0,this.isLoaded=!0,this.f.cleanerGroup.setValue(this.group)},error:n=>{this.alertService.error(n)}})})}ngOnInit(){this.id=this.route.snapshot.params.id}ngOnDestroy(){console.log("Called"),this.connection.stop().catch(t=>console.error(t.toString()))}applyFilter(t,n){var a=t.value;a=(a=a.trim()).toLowerCase(),this.dataSource.filter=a}functionValidator(t){return""===t.value?{invalidFunction:!0}:null}onDutyChanged(t){t.value==this.CLEANER_STR?(this.form.get("cleanerGroup").enable(),this.f.cleanerGroup.setValue(this.group)):this.form.get("cleanerGroup").disable()}get f(){return this.form.controls}onAddSchedule(){if(this.submitted=!0,this.alertService.clear(),this.form.invalid)return this.form.markAsTouched(),void this.f.cleanerGroup.markAsTouched();var t=this.createSchedule("scheduledDate","function");null!=t&&(this.isAdding=!0,this.accountService.addSchedule(this.account.id,t).pipe((0,h.P)()).subscribe({next:n=>{this.updateSchedulesFromServer(),this.initSchedules(n)},complete:()=>{this.isAdding=!1},error:n=>{this.updateSchedulesFromServer(),this.alertService.error(n),this.isAdding=!1}}))}onInputFunc(t,n){return this.uppercasePipe.transform(n.key)}createSchedule(t,n){var i=new Date(this.form.controls[t].value);i.setSeconds(0);var a=C(i).format(p.g.dateTimeFormat),s=this.form.controls[n].value;for(let D=0;D<this.schedules.length;D++){new Date(this.schedules[D].date).getTime();var A=this.schedules[D].userFunction;if(this.schedules[D].date==a&&A==s)return this.alertService.warn("The user is already "+A+" for that date/time"),null}var Z="";return this.form.controls.cleanerGroup.enabled&&(Z=this.form.controls.cleanerGroup.value),{accountId:this.account.id,date:a,newDate:a,dob:this.account.dob,required:!0,deleting:!1,userAvailability:!0,scheduleGroup:Z,userFunction:this.form.controls[n].value,newUserFunction:this.form.controls[n].value}}onDeleteSchedule(t,n){n.deleting=!0,this.accountService.deleteSchedule(this.account.id,n).pipe((0,h.P)()).subscribe({next:i=>{this.updateSchedulesFromServer()},complete:()=>{n.deleting=!1},error:i=>{this.alertService.error(i),n.deleting=!1,this.updateSchedulesFromServer()}})}updateSchedulesFromServer(){this.accountService.getById(this.id).pipe((0,h.P)()).subscribe(t=>{this.accountService.getTasks().pipe((0,h.P)()).subscribe({next:n=>{this.functions=n,this.initSchedules(t)},error:n=>{this.alertService.error(n)}})})}onDateChanged(t,n){var s=t.value.toDate();n.newDate=s.setSeconds(0).toString(),n.newUserFunction=n.userFunction,this.updateSchedules(n)}onUserFunctionChanged(t,n){n.newUserFunction=t.value,n.newDate=n.date,this.updateSchedules(n)}onCleanerGroupPressed(t){console.log("You entered: ",t.target.value)}updateSchedules(t){this.isUpdating=!0,this.alertService.clear(),this.accountService.updateSchedule(this.account.id,t).pipe((0,h.P)()).subscribe({next:n=>{console.log(n),this.initSchedules(n)},complete:()=>{this.isUpdating=!1},error:n=>{this.alertService.error(n),this.isUpdating=!1}})}onRowSelected(t,n,i){if(t.highlighted=!t.highlighted,this.currentSelectedSchedule=t,!t.deleting){var a=C(t.date,p.g.dateTimeFormat).toDate();this.form.get("scheduledDate").setValue(a),this.form.get("function").setValue(t.userFunction),this.form.get("cleanerGroup").setValue(t.scheduleGroup)}null!=this.lastSelectedSchedule&&(this.lastSelectedSchedule.highlighted=!1),this.lastSelectedSchedule=this.currentSelectedSchedule,t.highlighted||(this.lastSelectedSchedule=null,this.currentSelectedSchedule=null)}initSchedules(t){this.schedules=t.schedules.slice(),this.schedules.forEach(i=>{var a=new Date(i.date),s=C(a).format(p.g.dateTimeFormat);i.date=s}),this.dataSource=new u.by(this.schedules),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}get isAdmin(){return this.account.role==N.uU.Admin}get isCleaner(){return null!=this.form&&this.form.get("function").value===this.CLEANER_STR}get group(){var t=this.account.userFunctions.find(n=>n.group.length>0);return null!=t?t.group:""}get isReadOnly(){return this.group.length>0}static#e=this.\u0275fac=function(n){return new(n||r)(e.Y36(_.B),e.Y36(g.gz),e.Y36(g.F0),e.Y36(c.qu),e.Y36(_.c),e.Y36(e.sBO),e.Y36(m.gd))};static#t=this.\u0275cmp=e.Xpm({type:r,selectors:[["ng-component"]],viewQuery:function(n,i){if(1&n&&(e.Gf(nt,5),e.Gf(S.YE,5)),2&n){let a;e.iGM(a=e.CRH())&&(i.paginator=a.first),e.iGM(a=e.CRH())&&(i.sort=a.first)}},outputs:{onScheduledAdded:"onScheduledAdded"},decls:32,vars:7,consts:[[3,"formGroup",4,"ngIf"],[1,"container"],["appearance","outline"],["matInput","","placeholder","Search columns",3,"keyup"],["input",""],["matSort","",2,"min-width","800px",3,"dataSource"],["table",""],["matColumnDef","date"],["mat-sort-header","",4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","userFunction"],["matColumnDef","scheduleGroup"],["matColumnDef","action"],[4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[3,"ngClass","click","mouseover","mouseout",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"length","pageSizeOptions"],["paginator",""],["type","button",1,"mb-3"],["routerLink","/admin/accounts",1,"btn","btn-primary"],[1,"row","mt-3"],[3,"formGroup"],[1,"row"],[1,"mb-3","col-5"],[1,"mb-3","col-6"],["formControlName","scheduledDate","matInput","","placeholder","Choose a date","required","",3,"ngxMatDatetimePicker"],["ref",""],["matSuffix","",3,"for"],[3,"showSpinners","showSeconds","stepHour","stepMinute","stepSecond","touchUi","color","enableMeridian","disableMinute","hideTime"],["picker",""],[4,"ngIf"],[1,"row","equal"],[1,"mb-3","col-3"],["formControlName","function","required","",3,"ngClass","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["class","alert alert-danger",4,"ngIf"],["class","mb-3 col-3",4,"ngIf"],["class","mb-3",4,"ngIf"],[3,"value"],[1,"alert","alert-danger"],["type","text","matInput","","formControlName","cleanerGroup","placeholder","Specify a group",1,"form-control",3,"readonly"],["groupData",""],[1,"mb-3"],["type","button",1,"btn","btn-primary",3,"ngClass","click"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],[1,"spinner-border","spinner-border-sm","mr-1"],["mat-sort-header",""],["type","text","matInput","","readonly","",3,"value","dateChange"],["type","text","matInput","","placeholder","None","readonly","",3,"value","selectionChange"],["data",""],["type","text","matInput","","placeholder","None","readonly","",3,"value","keydown.enter"],["mat-raised-button","","color","warn",3,"click"],[3,"ngClass","click","mouseover","mouseout"],["tr",""]],template:function(n,i){if(1&n){const a=e.EpF();e.YNc(0,mt,33,24,"form",0),e.TgZ(1,"fieldset")(2,"legend"),e._uU(3,"Assigned Dates:"),e.qZA(),e.TgZ(4,"div",1)(5,"mat-form-field",2)(6,"mat-label"),e._uU(7,"Filter"),e.qZA(),e.TgZ(8,"input",3,4),e.NdJ("keyup",function(l){e.CHM(a);const f=e.MAs(9);return e.KtG(i.applyFilter(l.target,f))}),e.qZA()()(),e.TgZ(10,"mat-table",5,6),e.ynx(12,7),e.YNc(13,pt,2,0,"mat-header-cell",8)(14,ht,2,1,"mat-cell",9),e.BQk(),e.ynx(15,10),e.YNc(16,ft,2,0,"mat-header-cell",8)(17,gt,3,1,"mat-cell",9),e.BQk(),e.ynx(18,11),e.YNc(19,_t,2,0,"mat-header-cell",8)(20,St,3,2,"mat-cell",9),e.BQk(),e.ynx(21,12),e.YNc(22,Ct,2,0,"mat-header-cell",13)(23,xt,4,1,"mat-cell",9),e.BQk(),e.YNc(24,Tt,1,0,"mat-header-row",14)(25,Ft,2,4,"mat-row",15),e.qZA(),e._UZ(26,"mat-paginator",16,17),e.qZA(),e.TgZ(28,"div",18)(29,"a",19),e._uU(30,"Back"),e.qZA()(),e._UZ(31,"div",20)}2&n&&(e.Q6J("ngIf",i.isLoaded&&!i.isAdmin),e.xp6(10),e.Q6J("dataSource",i.dataSource),e.xp6(14),e.Q6J("matHeaderRowDef",i.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",i.displayedColumns),e.xp6(1),e.Q6J("length",i.schedules.length)("pageSizeOptions",e.DdM(6,Zt)))},dependencies:[m.mk,m.sg,m.O5,c._Y,c.Fj,c.JJ,c.JL,c.Q7,c.sg,c.u,g.rH,U.lW,u.BZ,u.fO,u.as,u.w1,u.Dz,u.nj,u.ge,u.ev,u.XQ,u.Gk,S.YE,S.nU,y.NW,M.nW,F.Nt,v.KE,v.hX,v.bx,v.TO,v.R9,T.rZ,T.T$,k.gD,x.ey],styles:["fieldset[_ngcontent-%COMP%]{margin:8px;border:1px solid silver;padding:8px;border-radius:4px}legend[_ngcontent-%COMP%]{background-color:#000;color:#fff;padding:3px 6px}[_nghost-%COMP%]{--bg-color: rgba(100, 100, 100, .5)}.highlighted[_ngcontent-%COMP%], .mat-mdc-table[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]:hover, .mat-mdc-table[_ngcontent-%COMP%]   .mat-mdc-footer-row[_ngcontent-%COMP%]:hover{background:var(--bg-color)}"]})}return r})();var Mt=d(786);const Q=["progressFile"];function wt(r,o){if(1&r&&(e.TgZ(0,"div",13)(1,"label",14),e._uU(2,"File progress:"),e.qZA(),e._UZ(3,"progress",15,16),e.qZA()),2&r){const t=e.oxw();e.xp6(3),e.Q6J("value",t.uploadProgress)}}const Ut=[{path:"",component:pe},{path:"add-edit",loadChildren:()=>d.e(131).then(d.bind(d,9131)).then(r=>r.AddEditModule)},{path:"upload",component:(()=>{class r{constructor(t,n,i,a,s){this.alertService=n,this.router=i,this.route=a,this.renderer=s,this.fileName="",this.uploadProgress=0,this.submitted=!1,this.fileHasBeenSelected=!1,this.accountService=t}ngAfterViewInit(){this.progressChildren.changes.subscribe(t=>{null!=t.first&&t.first.nativeElement.removeAttribute("value")})}ngOnInit(){this.fileName=""}onFileSelected(t){const n=t.target.files[0];n?(this.fileHasBeenSelected=!0,this.fileName=n.name):this.fileHasBeenSelected=!1}onSubmit(t,n){const i=n.files[0];if(i){this.submitted=!0,this.fileName=i.name;const a=new FormData;if(a.append("file",i),"application/x-msdownload"==i.type)return void this.alertService.error("File must be an .xlsx file type");const s=this.accountService.uploadAccountsFile(a).pipe((0,Mt.x)(()=>{this.reset()}));this.uploadSub=s.subscribe({next:l=>{},complete:()=>{this.alertService.info("Done"),this.submitted=!1,this.uploadProgress=-1,this.router.navigate(["../"],{relativeTo:this.route})},error:l=>{this.alertService.error(l),this.submitted=!1}})}}cancelUpload(){this.uploadSub.unsubscribe(),this.reset()}reset(){this.uploadProgress=null,this.uploadSub=null}static#e=this.\u0275fac=function(n){return new(n||r)(e.Y36(_.B),e.Y36(_.c),e.Y36(g.F0),e.Y36(g.gz),e.Y36(e.Qsj))};static#t=this.\u0275cmp=e.Xpm({type:r,selectors:[["app-upload-accounts"]],viewQuery:function(n,i){if(1&n&&(e.Gf(Q,5),e.Gf(Q,5)),2&n){let a;e.iGM(a=e.CRH())&&(i.progressChild=a.first),e.iGM(a=e.CRH())&&(i.progressChildren=a)}},inputs:{requiredFileType:"requiredFileType"},decls:23,vars:3,consts:[[1,"container"],[1,"row"],[1,"mb-3","col-6"],[1,"file-upload"],["type","button","color","primary",1,"btn","btn-primary","upload-button",3,"click"],["src","./assets/images/Upload.png"],["method","post","enctype","multipart/form-data"],["type","file","accept",".xlsx","required","",1,"file-input",3,"change"],["fileUpload",""],[1,"col-1"],[1,"btn","btn-primary",3,"disabled","click"],["routerLink","../",1,"btn","btn-primary"],["col-12","",4,"ngIf"],["col-12",""],["for","file"],["id","progress-bar","max","100",3,"value"],["progressFile",""]],template:function(n,i){if(1&n){const a=e.EpF();e.TgZ(0,"fieldset")(1,"legend"),e._uU(2,"Upload Accounts"),e.qZA(),e.TgZ(3,"div",0)(4,"div",1)(5,"div",2)(6,"div",3),e._uU(7),e.TgZ(8,"button",4),e.NdJ("click",function(){e.CHM(a);const l=e.MAs(13);return e.KtG(l.click())}),e._UZ(9,"img",5),e.qZA()(),e.TgZ(10,"form",6)(11,"div")(12,"input",7,8),e.NdJ("change",function(l){return i.onFileSelected(l)}),e.qZA()()()(),e.TgZ(14,"div")(15,"div",1)(16,"div",9)(17,"button",10),e.NdJ("click",function(l){e.CHM(a);const f=e.MAs(13);return e.KtG(i.onSubmit(l,f))}),e._uU(18,"Submit"),e.qZA()(),e.TgZ(19,"div",9)(20,"a",11),e._uU(21,"Back"),e.qZA()()()(),e.YNc(22,wt,5,1,"div",12),e.qZA()()()}2&n&&(e.xp6(7),e.hij(" ",i.fileName||"No file uploaded yet."," "),e.xp6(10),e.Q6J("disabled",!i.fileHasBeenSelected||i.submitted),e.xp6(5),e.Q6J("ngIf",i.submitted))},dependencies:[m.O5,c._Y,c.JL,c.F,g.rH],styles:[".file-input[_ngcontent-%COMP%]{display:none}.upload-button[_ngcontent-%COMP%]{width:32px;height:32px;padding:0;border:none}img[_ngcontent-%COMP%]{width:100%;height:100%;overflow:hidden}progress[_ngcontent-%COMP%]{text-align:center;width:100%}fieldset[_ngcontent-%COMP%]{margin:8px;border:1px solid silver;padding:8px;border-radius:4px}legend[_ngcontent-%COMP%]{background-color:#000;color:#fff;padding:3px 6px}"]})}return r})()},{path:"auto-generate-schedules",loadChildren:()=>d.e(898).then(d.bind(d,8898)).then(r=>r.AutoGeneratorModule)},{path:"function/:id",component:oe},{path:"schedule/:id",component:Dt},{path:"schedule-generate",component:je}];let kt=(()=>{class r{static#e=this.\u0275fac=function(n){return new(n||r)};static#t=this.\u0275mod=e.oAB({type:r});static#n=this.\u0275inj=e.cJS({imports:[g.Bz.forChild(Ut),g.Bz]})}return r})();const Nt={parse:{dateInput:p.g.dateTimeFormat},display:{dateInput:p.g.dateTimeFormat,monthYearLabel:"MMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}};class qt extends x.LF{format(o,t){if(t===p.g.dateFormat){var n=o.getDate().toString().padStart(2,"0"),a=(o.getMonth()+1).toString().padStart(2,"0");return`${o.getFullYear().toString().padStart(4,"0")}-${a}-${n}`}return o.toDateString()}}let Jt=(()=>{class r{static#e=this.\u0275fac=function(n){return new(n||r)};static#t=this.\u0275mod=e.oAB({type:r});static#n=this.\u0275inj=e.cJS({providers:[{provide:m.gd},{provide:T.fM,useClass:w.Am,deps:[x.Ad,w.S9]},{provide:T.ab,useValue:Nt}],imports:[m.ez,c.u5,c.UX,kt,K.K,J.q,S.JX,u.p0,y.TU,U.ot,M.FA,x.XK,F.c,v.lN,T.EC,w._W,k.LD,V,Y,L.f,y.TU]})}return r})()}}]);
//# sourceMappingURL=905.ad2c6116ad3ac543.js.map