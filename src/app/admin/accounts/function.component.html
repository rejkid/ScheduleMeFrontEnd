<!-- <form [formGroup]="form" *ngIf="isLoaded && !isAdmin">
    <div class="border-primary">
        <div class="row" *ngIf="isLoggedAsAdmin">
            <div class="mb-3 col-5">
                <label>Choose Duties for {{account.firstName}}</label>
                <select formControlName="function" class="form-select"
                    [ngClass]="{ 'is-invalid': submitted && f['function'].errors }" (change)="onTaskChanged($event)"
                    #functionSelected>
                    @for(item of possibleTasks; track item) {
                    <option>{{ item.userFunction }}
                    </option>
                    }
                </select>

                <div *ngIf="submitted && form.controls['function'].hasError('invalidFunction')"
                    class="alert alert-danger">Duty
                    can't be empty</div>
            </div>


            <div class="col-3" *ngIf="isGroupTaskSelected">
                <div class="row">
                    <div class="col-1 pb-3">
                        <label for="group">Team</label>
                        <input type="text" #data formControlName="groupTask" name="group"
                            placeholder="Specify a group" />
                    </div>
                </div>
                <div *ngIf="submitted && form.controls['groupTask'].hasError('invalidGroup')"
                    class="alert alert-danger">Group
                    can't be empty</div>
            </div>
        </div>
    </div>
</form> -->


<form [formGroup]="form" *ngIf="isLoaded && !isAdmin">
    <fieldset>
        <legend>Tasks</legend>

        <div class="col-10">
            <div class="container">
                <div class="border-primary">
                    <div class="row" *ngIf="isLoggedAsAdmin">
                        <div class="mb-3 col-5">
                            <label>Choose Task for {{account.firstName}} {{account.lastName}}</label>
                            <select formControlName="function" class="form-select"
                                [ngClass]="{ 'is-invalid': submitted && f['function'].errors }"
                                (change)="onTaskChanged($event)" #functionSelected>
                                @for(item of possibleTasks; track item) {
                                <option>{{ item.agentTaskStr }}
                                </option>
                                }
                            </select>

                            <div *ngIf="submitted && form.controls['function'].hasError('invalidFunction')"
                                class="alert alert-danger">Duty
                                can't be empty</div>
                        </div>


                        <div class="col-5" *ngIf="isGroupTaskSelected">
                            <div class="row">
                                <div class="col-12">
                                    <label for="group">Group</label>
                                    <input type="text" #data formControlName="groupTask" name="group"
                                        placeholder="Specify a group" class="form-control" />
                                </div>
                            </div>
                            <div *ngIf="submitted && form.controls['groupTask'].hasError('invalidGroup')"
                                class="alert alert-danger">Group
                                can't be empty</div>
                        </div>
                    </div>
                </div>


                <mat-form-field appearance="outline">
                    <mat-label>Filter</mat-label>
                    <input matInput (keyup)="applyFilter($event.target, input)" placeholder="Search columns" #input>
                </mat-form-field>

                <mat-table matSort class="lessons-table mat-elevation-z8" [dataSource]="dataSource">
                    <ng-container matColumnDef="{{displayedColumns[0]}}">
                        <mat-header-cell *matHeaderCellDef mat-sort-header> {{labeledColumns[0]}} </mat-header-cell>
                        <mat-cell *matCellDef="let function">
                            <input type="text" matInput [value]="function.userFunction" readonly />
                        </mat-cell>
                    </ng-container>

                    <ng-container matColumnDef="{{displayedColumns[1]}}">
                        <mat-header-cell *matHeaderCellDef mat-sort-header> {{labeledColumns[1]}} </mat-header-cell>
                        <mat-cell *matCellDef="let function">
                            <input type="text" matInput [value]="function.group" readonly />
                        </mat-cell>
                    </ng-container>

                    <ng-container matColumnDef="{{displayedColumns[2]}}">
                        <mat-header-cell *matHeaderCellDef> Action </mat-header-cell>
                        <mat-cell *matCellDef="let function">

                            <button (click)="deleteFunction(function)" class="btn btn-sm btn-danger btn-delete-account"
                                [disabled]="function.isDeleting">
                                <span *ngIf="function.isDeleting" class="spinner-border spinner-border-sm"></span>
                                <span *ngIf="!function.isDeleting">Delete</span>
                            </button>

                        </mat-cell>
                    </ng-container>

                    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>

                    <mat-row *matRowDef="let row; columns: displayedColumns;let i = index;"
                        [ngClass]="{'highlighted': row.highlighted}" #tr (click)="onRowSelected(row, tr, i, $event)"
                        (mouseover)="row.hovered = true" (mouseout)="row.hovered = false"></mat-row>
                </mat-table>
                <mat-paginator #paginator class="lessons-table mat-elevation-z8" [length]="userFunctions().length"
                    [pageSizeOptions]="[10, 30, 50, 100]" showFirstLastButtons>
                </mat-paginator>
                <div class="mt-3">
                    <button type="button" (click)="addFunction()" class="btn3d btn btn-primary">
                        Add
                    </button>
                </div>

            </div>
        </div>
    </fieldset>
</form>

@if(isLoaded) {
<div class="container">
    <div class="mb-3">
        <a routerLink="/admin/accounts/add-edit/edit/{{account.id}}" class="btn3d btn btn-primary">Back</a>
    </div>
</div>
}